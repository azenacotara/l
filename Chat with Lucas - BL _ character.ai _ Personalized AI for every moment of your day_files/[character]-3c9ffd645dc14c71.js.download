(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5564],{79151:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[character]",function(){return s(89478)}])},72422:function(e,t,s){"use strict";s.d(t,{m:function(){return j}});var a=s(52322),l=s(2784),r=s(37940),n=s(35981),i=s(93326),c=s(92599),o=s(55264),d=s(39097),u=s.n(d),x=s(10386),m=s(7552);let h=["description","definition"],f=e=>{let{character:t}=e,{t:s}=(0,x.$G)(),l=e=>{o.Wj.copyTextToClipboard(null!=e?e:"",s("Common.message-copied-to-clipboard"),"ChatMessage")};return(0,a.jsx)("div",{className:"h-full overflow-y-auto w-full flex flex-col gap-2 pb-2",children:h.map(e=>t[e]?(0,a.jsxs)("div",{className:"h-fit max-h-full flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,a.jsx)("p",{children:s("CharacterEditor.Form.".concat(e))}),(0,a.jsx)(i.zx,{onPress:()=>l(t[e]),variant:"ghost",size:"sm",startContent:(0,a.jsx)(c.TIy,{height:"1rem"}),analytics:{name:"elementClicked",properties:{type:"copy-".concat(e),referrer:"ViewCharacterSheet"}},children:s("Common.copy")})]}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-line",children:t[e]})]},e):null)})},p=l.forwardRef((e,t)=>{let{character:s}=e,{t:r}=(0,x.$G)(),[n,o]=(0,l.useState)(!1);return(0,a.jsxs)(m.yo,{onOpenChange:o,open:n,modal:!1,children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(i.zx,{variant:"ghost",className:"w-full flex flex-row justify-between rounded-spacing-xs",onPress:()=>{o(!0)},endContent:(0,a.jsx)(c.tEF,{width:"1rem",height:"1rem"}),children:r("Common.view-character-details")})}),(0,a.jsxs)(m.ue,{className:"flex h-full flex-col w-96 max-w-80",ref:t,children:[(0,a.jsx)(m.sw,{children:(0,a.jsxs)(m.Tu,{className:"flex flex-row items-center gap-6",children:[(0,a.jsx)(c.XCv,{className:"text-muted-foreground size-4"}),r("Common.view-character-details")]})}),(0,a.jsx)(f,{character:s})]})]})});p.displayName="ViewCharacterSheet";let v=l.forwardRef((e,t)=>{let{characterId:s}=e,{t:l}=(0,x.$G)();return(0,a.jsx)(u(),{href:o.nN.character(s),children:(0,a.jsxs)("div",{ref:t,className:"p-2 px-3 w-full flex justify-between items-center bg-surface-elevation-3 hover:bg-[--transparency-4] text-primary rounded-spacing-s",children:[l("Common.edit"),(0,a.jsx)(c.dY8,{width:"1rem",height:"1rem"})]})})});v.displayName="EditOption";let g=e=>{let{thisIsMyCharacter:t,character:s}=e;return(0,l.useMemo)(()=>{let e=[];return t&&e.push({content:(0,a.jsx)(v,{characterId:s.external_id}),asChild:!0,key:"edit"}),s.copyable&&h.map(e=>!!s[e]).some(Boolean)&&!t&&e.push({content:(0,a.jsx)(p,{character:s}),asChild:!0,key:"view"}),e},[t,s])},j=e=>{let{thisIsMyCharacter:t,character:s,alwaysShow:c,contentClassName:o}=e,d=g({character:s,thisIsMyCharacter:t}),[u,x]=(0,l.useState)(!1);return d.length?(0,a.jsx)(n.C,{options:d,setIsOpen:x,isOpen:u,triggerClassName:c?"opacity-100":"",contentClassName:o,asChild:!0,children:(0,a.jsx)(i.zx,{variant:c?"outline":"ghost",color:"secondary",isIconOnly:!0,preventDefault:!0,onPress:()=>x(!u),children:(0,a.jsx)(r.evw,{})})}):null}},76843:function(e,t,s){"use strict";s.d(t,{w:function(){return h}});var a=s(52322),l=s(35981),r=s(93326),n=s(61676),i=s(2784),c=s(10386),o=s(37940),d=s(35740),u=s(38738),x=s(95856);function m(e){var t,s;let{persona:l}=e,{participant__name:r,avatar_file_name:n}=l,i=(0,d.a)().user,{data:c}=(0,u.xS)(null!==(s=null==i?void 0:null===(t=i.user)||void 0===t?void 0:t.username)&&void 0!==s?s:"",!1);return(0,a.jsx)(x.B7,{...e,src:n||(null==c?void 0:c.avatar_file_name),name:r})}function h(e){let{persona:t,isDefault:s,handleItemClick:d,handleEditClick:u,selected:x,menuOptions:h,avatarSize:f,...p}=e,{t:v}=(0,c.$G)(),[g,j]=(0,i.useState)(!1),{participant__name:N,definition:b}=t;return(0,a.jsxs)("div",{className:(0,n.cn)("my-1 flex w-full h-fit group flex-row gap-3 p-2 items-center rounded-spacing-xs text-primary hover:cursor-pointer",u&&(s||x)?"bg-accent":"bg-transparent",u?"hover:bg-accent":"hover:bg-surface-elevation-3"),onClick:()=>d&&d(),...p,children:[(0,a.jsx)(m,{persona:t,size:null!=f?f:40,circle:!0}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col w-full max-w-full justify-center",children:[(0,a.jsxs)("div",{className:"flex flex-1 gap-2 items-center",children:[(0,a.jsx)("p",{className:"line-clamp-1 text-ellipsis break-anywhere text-md sm:text-lg",children:N}),!!(s||x)&&(0,a.jsx)("p",{className:"text-blue text-md sm:text-lg",children:v(s?"Common.default":"Common.active")})]}),(0,a.jsx)("p",{className:"text-left text-sm sm:text-md mb-1 line-clamp-1 text-ellipsis break-anywhere text-muted-foreground",children:b})]}),!!u&&(0,a.jsx)(r.zx,{onPress:()=>{u&&u()},className:"hidden group-hover:block",variant:"primary",preventDefault:!0,children:v("Common.edit")}),!!h&&h.length>0&&(0,a.jsx)("div",{className:"z-50",children:(0,a.jsx)(l.C,{options:h,setIsOpen:j,isOpen:g,asChild:!0,children:(0,a.jsx)(r.zx,{variant:"ghost",isIconOnly:!0,preventDefault:!0,onPress:()=>j(!g),children:(0,a.jsx)(o.evw,{})})})})]})}},46600:function(e,t,s){"use strict";s.d(t,{$u:function(){return o},es:function(){return i},j$:function(){return c}});var a=s(3048),l=s(38694),r=s(24991),n=s(30195);let i=e=>{let t=e?a.Fx:a.fY;return n.z.object({name:n.z.string().min(a.S1).max(a.vl).regex(l.vk,(0,r.t)("Form.invalid-characters")),definition:n.z.string().max(t,"Definition cannot be longer than ".concat(t," characters")),avatar_rel_path:n.z.string().optional(),enabled:n.z.boolean()})},c={external_id:"new",name:"",participant__name:"",definition:""},o=(e,t,s)=>{var a,l;let r=(null==s?void 0:null===(a=s.personaOverrides)||void 0===a?void 0:a[t])===e,n=(null==s?void 0:null===(l=s.personaOverrides)||void 0===l?void 0:l[t])===void 0,i=(null==s?void 0:s.default_persona_id)===e&&n;return r||i}},12955:function(e,t,s){"use strict";s.d(t,{R:function(){return m}});var a=s(52322),l=s(55541),r=s(67378),n=s(61676),i=s(84938),c=s(82876),o=s(2784),d=s(10386),u=s(92599),x=s(93326);function m(e){let{isCompact:t}=e,s="true"===(0,c.useSearchParams)().get("voice"),{t:m}=(0,d.$G)(),{isVoiceEnabled:h,enableVoice:f,disableVoice:p,onRequestVoice:v,hasVoice:g,voiceId:j}=(0,r.AW)(),{voice:N}=(0,i.Kl)(j,!1),[b,w]=(0,o.useState)(!1);if((0,o.useEffect)(()=>{s&&g&&f()},[g,s,f]),t)return h?(0,a.jsx)(x.zx,{"aria-label":m("Voice.toggle-voice"),onPress:p,variant:"outline",isIconOnly:!0,children:(0,a.jsx)(u.uAs,{className:"size-4 text-voice-blue"})}):(0,a.jsx)(x.zx,{"aria-label":m("Voice.toggle-voice"),onPress:f,variant:"outline",isIconOnly:!0,children:g?(0,a.jsx)(u.AsP,{className:"size-4"}):(0,a.jsx)(u.TW3,{className:"size-4"})});let y=!j&&g;return(0,a.jsxs)("div",{className:(0,n.cn)("flex gap-2 items-center rounded-spacing-xs",{"bg-surface-elevation-1":b}),onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:[(0,a.jsx)("div",{className:"pl-3",children:h?(0,a.jsx)(l.l,{content:m("Chat.disable-voice-tooltip"),side:"left",children:(0,a.jsx)(x.zx,{"aria-label":m("Voice.toggle-voice"),onPress:p,variant:"ghost",isIconOnly:!0,className:"bg-surface-elevation-2 hover:bg-surface-elevation-3",style:{minWidth:30,width:30,height:30},children:(0,a.jsx)(u.uAs,{className:"size-4 text-voice-blue"})})}):(0,a.jsx)(l.l,{content:m("Chat.enable-voice-tooltip"),side:"left",children:(0,a.jsx)(x.zx,{"aria-label":m("Voice.toggle-voice"),onPress:f,variant:"ghost",isIconOnly:!0,className:"bg-surface-elevation-2 hover:bg-surface-elevation-3",style:{minWidth:30,width:30,height:30},children:j?(0,a.jsx)(u.AsP,{className:"size-4"}):(0,a.jsx)(u.TW3,{className:"size-4"})})})}),(0,a.jsxs)(x.zx,{variant:"ghost",className:"w-full flex justify-between rounded-spacing-xs pl-0 hover:bg-surface-elevation-1",onPress:v,children:[(0,a.jsx)("div",{className:"flex items-center w-fit",children:m("Chat.enable-voice")}),(0,a.jsxs)("div",{className:"flex gap-1 items-center text-muted-foreground",children:[!!y&&(0,a.jsx)("div",{children:m("Common.default")}),(0,a.jsx)("div",{children:null==N?void 0:N.name}),(0,a.jsx)("div",{children:(0,a.jsx)(u.XCv,{className:"size-3"})})]})]})]})}},20606:function(e,t,s){"use strict";s.d(t,{E:function(){return i}});var a=s(52322),l=s(54835),r=s(2784),n=s(61676);let i=r.forwardRef((e,t)=>{let{className:s,value:r,...i}=e;return(0,a.jsx)(l.fC,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,a.jsx)(l.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});i.displayName=l.fC.displayName},91724:function(e,t,s){"use strict";s.d(t,{Y:function(){return f},Zo:function(){return l},bR:function(){return p}});var a,l,r=s(35740),n=s(55264),i=s(79937),c=s(85108),o=s(5632),d=s(2784),u=s(30195);(a=l||(l={})).Characters="characters",a.Liked="liked",a.Voices="voices",a.Personas="personas";let x="characters",m=u.z.object({username:u.z.string(),tab:u.z.string()}).partial(),h=e=>e&&Object.values(l).includes(e)?e:x,f=e=>{let t=(0,o.useRouter)(),s=m.safeParse(t.query),{tab:a}=s.success?s.data:{tab:x},[l,r]=(0,d.useState)(h(a));return{selectedTab:l,handleTabChange:s=>{let a=h(s);r(a),t.replace(n.nN.profile(e,a),void 0,{shallow:!0})}}},p=()=>{var e;let{user:t}=(0,r.a)();return(0,c.a)({queryKey:["publicUser",null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.username],queryFn:()=>(0,i.m)().fetchCharactersCreatedByUser(),select:e=>(null==e?void 0:e.characters)||[]})}},89478:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return sv},default:function(){return sN},runtime:function(){return sg}});var a,l,r=s(52322),n=s(30597),i=s(2784),c=s(48364),o=s(6669),d=s(21236),u=s(50567),x=s(92599),m=s(92488),h=s(61503),f=s(83614),p=s(59131);let v={receivingSlowResponses:{icon:x.GxE,textKey:"Chat.upsells.receiving-slow-responses",trigger:"header-receiving-slow-responses",isDismissable:!0,onPress:()=>{m.mL.value={showModal:!0,referrer:"header-receiving-slow-responses"}}},discountUpsell:{icon:x.lO_,textKey:"Chat.upsells.discount",subtitleTextKey:"Subscription.limited-offer",trigger:"header-discount-upsell",isDismissable:!0,onPress:()=>{m.Um.value={referrer:"ThrottledMessages",trigger:"header-discount-upsell",addDiscount:!0}}},discountUpsellPrice:{icon:x.lO_,textKey:"Chat.upsells.discount-v2",subtitleTextKey:"Subscription.limited-offer",trigger:"header-discount-upsell",isDismissable:!0,onPress:()=>{m.Um.value={referrer:"ThrottledMessages",trigger:"header-discount-upsell",addDiscount:!0}}}},g=()=>{let e=(0,f.useLayer)(u.db.Throttling).get("header_copy_variant",void 0),t=(0,f.useGateValue)(u.F5.ThrottlingKillSwitch),s=(0,h.i)();return t&&s&&e&&v[e]?v[e]:null},j=()=>{let{t:e}=(0,p.$G)(),[t,s]=(0,i.useState)(!1),a=g();if((0,i.useEffect)(()=>{a&&d.iN.contentViewed({referrer:"Chat",type:a.trigger})},[a]),!a||t)return null;let l=a.icon;return(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 flex justify-center mt-24 2xl:mt-12 px-4 z-10  flex-row items-center rounded-full border border-elevation-4 bg-surface/98  py-2 shadow-md backdrop-blur-md w-max min-h-[40px]",children:[(0,r.jsx)(l,{className:"mr-2 w-6 h-6 text-primary shrink-0"}),(0,r.jsxs)("div",{onClick:a.onPress,"aria-label":e(a.textKey),className:"text-sm mr-2 cursor-pointer select-none flex flex-col shrink",children:[!!a.subtitleTextKey&&(0,r.jsx)("span",{className:"text-muted-foreground text-[11px] mr-1",children:e(a.subtitleTextKey).toUpperCase()}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)(p.cC,{i18nKey:a.textKey,children:[(0,r.jsx)("span",{className:"text-blue-500",children:"Highlighted term"}),(0,r.jsx)("del",{})]})})]}),!!a.isDismissable&&(0,r.jsx)("button",{type:"button",className:"flex items-center justify-center p-1 rounded-full hover:bg-surface-elevation-2 transition-colors ml-1",onClick:()=>s(!0),"aria-label":e("Common.dismiss"),style:{lineHeight:0},children:(0,r.jsx)(x.Two,{className:"w-5 h-5 text-muted-foreground"})})]})})};var N=s(36833),b=s(29700),w=s(35740),y=s(55274),C=s(77388),_=s(67378),k=s(96370),S=s(92138),z=s(9441),G=s(2336),M=s(95856),P=s(27714),I=s(46086),E=s(2608),O=s(8699),F=s(57960),T=s(28450);(a=l||(l={})).Disconnected="disconnected",a.Connecting="connecting",a.Connected="connected",a.Complete="complete",a.Failed="failed";let D=(e,t)=>{let{characterId:s}=(0,y.AU)(),a=(0,i.useRef)(0),l=(0,i.useRef)({character_id:s}),r=(0,i.useRef)(0),n=(0,i.useRef)("disconnected"),c=(0,T.Er)(e,t),o=(0,T.XV)(e,t);return(0,i.useEffect)(()=>{"disconnected"===n.current&&c&&(d.iN.voiceCallStateChange({referrer:"voice_call_analytics_hook",type:"connecting",...l.current}),r.current=Date.now(),n.current="connecting")},[c]),(0,i.useEffect)(()=>{"connecting"===n.current&&o&&(d.iN.voiceCallStateChange({referrer:"voice_call_analytics_hook",type:"connected",...l.current,connect_time_ms:Date.now()-r.current}),r.current=Date.now(),n.current="connected")},[o]),(0,i.useEffect)(()=>{t===F.Td.Backend&&a.current++},[t]),{logCallCompleted:(0,i.useCallback)(e=>{"connected"===n.current?(d.iN.voiceCallStateChange({referrer:"voice_call_analytics_hook",type:"complete",...l.current,user_turn_count:a.current,call_duration_ms:Date.now()-r.current,reason:e}),n.current="complete"):"connecting"===n.current&&(d.iN.voiceCallStateChange({referrer:"voice_call_analytics_hook",type:"failed",...l.current,user_turn_count:a.current,connect_time_ms:Date.now()-r.current,reason:e}),n.current="complete")},[])}};var R=s(89956),B=s(10386),A=s(15584);let U=e=>{var t;let[s,a]=(0,i.useState)(!1),l=(null===(t=(0,A.BF)(m.OO))||void 0===t?void 0:t.status)==="playing",r=(0,i.useRef)();return(0,i.useEffect)(()=>{e!==F.Td.Backend||e===r.current||l?a(!1):a(!0),r.current=e},[e,l]),{isAiThinking:s}},$=(e,t)=>{var s;let{t:a}=(0,B.$G)(),{character:l}=(0,y.AU)(),{token:r,user:n}=(0,w.a)(),o=null==n?void 0:null===(s=n.user)||void 0===s?void 0:s.username,[d,u]=(0,i.useState)(),{mconnect:x,mdisconnect:h,muteMicrophone:f,microphoneMuteStatus:p,rtcConnectionStatus:v,voiceCallTurnStatus:g,isUserSpeaking:j}=(0,O.D)(m.NT,e,t),{logCallCompleted:N}=D(v,g),b=(0,A.BF)(m.NT),[C,_]=(0,A.zb)(!1),{voiceId:k,voiceQuery:S,hasVoice:z,chatId:G,isVoiceLoading:M}=(0,R.E$)(),P=(0,i.useCallback)((e,t)=>{N(e),(null==t?void 0:t.toastProps)&&(0,E.K)(t.toastProps.text1)},[N]);(0,i.useEffect)(()=>{(0,T._v)(m.NT)},[]),(0,i.useEffect)(()=>()=>{N("unmount"),h()},[h,N]),(0,i.useEffect)(()=>{o&&r&&u({username:o,userAuthToken:r})},[o,r]);let I=b&&!!G&&!!(null==l?void 0:l.external_id)&&!M&&z&&!!d;return(0,i.useEffect)(()=>{I&&x({chatId:G,voiceId:k,voiceQuery:S,characterId:null==l?void 0:l.external_id,callArgs:d})},[x,I,null==l?void 0:l.external_id,G,k,S,d]),(0,i.useEffect)(()=>{if(_&&g===F.Td.Initializing){let e=setTimeout(()=>{(0,c.H)("Voice call initialization timeout",{type:c.NI.Voice}),P("no answer timeout",{toastProps:{text1:a("Voice.voice-call-connection-failed"),text2:a("Errors.please-try-again-later")}})},3e4);return()=>clearTimeout(e)}},[_,g,P,a]),(0,i.useEffect)(()=>{v===F.Fe.connecting||v===F.Fe.connected?C.value=!0:(v===F.Fe.failed||v===F.Fe.unconnected)&&C.value&&((0,c.H)("Voice call unexpectedly disconnected"),P("unexpected disconnect: ".concat(v)))},[v,C,P,a]),(0,i.useEffect)(()=>{!b&&C.value&&((0,c.H)("Voice call disabled unexpectedly",{type:c.NI.Voice}),P("externally disabled",{toastProps:{text1:a("Calls.voice-call-disconnected"),text2:a("Errors.please-try-again-later")}}))},[b,C,P,a]),{rtcConnectionStatus:v,voiceCallTurnStatus:g,hasVoice:z,muteMicrophone:f,hangUp:P,microphoneMuteStatus:p,isUserSpeaking:j,isVoiceLoading:M}};var K=s(75702),V=s(40789),H=s(55264),L=s(47022);let q={isConnected:!1,isConnecting:!1,isLoading:!0,voiceCallTurnStatus:F.Td.Initializing,hasVoice:!1,isUserMuted:!1,isAiThinking:!1,isUserSpeaking:!1,toggleMute:H.ws,hangUp:H.ws,audioTrackRef:void 0,isCharacterSpeaking:!1},X=i.createContext(q),Z=e=>{let{children:t}=e,s=(0,i.useMemo)(()=>new MediaStream,[]),a=(0,i.useMemo)(()=>window.AudioContext?new AudioContext:null,[]),l=(0,i.useMemo)(()=>window.MediaStream?new MediaStream:null,[]),n=(0,i.useMemo)(()=>AudioContext?new AudioContext:null,[]),{character:c,characterId:o}=(0,y.AU)(),{refresh:d}=(0,L.m)();(0,i.useEffect)(()=>()=>d(o,!1,!0),[d,o]);let{rtcConnectionStatus:u,voiceCallTurnStatus:x,hasVoice:m,muteMicrophone:h,hangUp:f,microphoneMuteStatus:p,isUserSpeaking:v,isVoiceLoading:g}=$(s,l),{isAiThinking:j}=U(x),N=(0,i.useCallback)(()=>{h("user")},[h]),b=!c||g,w=(0,T.XV)(u,x),[C,_]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(w&&s&&a)return(0,K.g)(s,a,()=>{_(!0)},()=>{_(!1)},V.vx.VoiceCallsMediaStream)},[a,w,s]),(0,i.useEffect)(()=>{if(w&&l&&n)return(0,K.g)(l,n,()=>{},()=>{},V.vx.VoiceCallsMicrophoneStream)},[n,w,l]),(0,i.useMemo)(()=>(0,r.jsx)(X.Provider,{value:{isLoading:b,isConnected:w,isConnecting:(0,T.Er)(u,x),voiceCallTurnStatus:x,hasVoice:m,isUserMuted:p===F.aB.UserMuted,isAiThinking:j,isUserSpeaking:v,isCharacterSpeaking:C,character:c,toggleMute:N,hangUp:f},children:t}),[C,b,w,u,x,m,p,j,v,c,N,f,t])},Y=()=>(0,i.useContext)(X);var J=s(47016);let W={Connected:"connected.mp3",UserTurn:"turn_alt.mp3",CharacterTurn:"turn.mp3",Mute:"mute.mp3",Unmute:"unmute.mp3"},Q=e=>{(0,J.Sk)("https://characterai.io/static/media/calls/".concat(e),"one-off",{})},ee=()=>{let{voiceCallTurnStatus:e,isUserMuted:t}=Y(),s=(0,i.useRef)(!1),a=(0,i.useRef)(!1);(0,i.useEffect)(()=>{e===F.Td.Client?s.current?Q(W.UserTurn):Q(W.Connected):e===F.Td.Backend&&(Q(W.CharacterTurn),s.current=!0)},[e]),(0,i.useEffect)(()=>{t?Q(W.Mute):a.current&&Q(W.Unmute),a.current=t},[t])};var et=s(46962),es=s(57352);let ea={Character:25,User:100,Neutral:50},el="#0687F1",er=0,en=()=>{let{voiceCallTurnStatus:e,isConnecting:t}=Y(),[s,a]=(0,i.useState)(ea.Neutral),[l,n]=(0,i.useState)(0),[c,o]=(0,i.useState)(0),d=(0,et.G)(),{hasCustomBackground:u}=(0,S.OF)();(0,i.useEffect)(()=>{er=Date.now();let e=(0,K.s)(V.vx.VoiceCallsMediaStream,e=>{n(Math.abs(e.reduce((e,t)=>e+t,0)/e.length)),function(e,t,s){var a;let l=document.getElementById("line-circle");if(!l)return;let r=function(e){let t=Math.max(...e.map(Math.abs));return e.map(e=>(e/t)**2)}(e),n=(a=ei,r.map((e,s)=>{var l;return Number.isNaN(e)?0:(l=a[s])+(e-l)*t})),i=function(e,t){let s=new Float32Array(36),a=e.length/t;for(let r=0;r<t;r++){var l;let t=r*a,n=Math.floor(t),i=(n+1)%e.length,c=t-n;s[r]=(l=e[n])+(e[i]-l)*c}return s}(n,36),c=2*Math.PI/36;for(;l.firstChild;)l.removeChild(l.firstChild);for(let e=0;e<s;e++){let t=e*c,s=70+32*Math.abs(i[e]),a=128+s*Math.cos(t),r=75+s*Math.sin(t),n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",a.toString()),n.setAttribute("cy",r.toString()),n.setAttribute("r","5"),n.setAttribute("fill",el),l.appendChild(n)}ei=n}(e,Math.min(.5,Math.abs(er-Date.now())/128),36),er=Date.now()});return()=>e()},[]),(0,i.useEffect)(()=>{let e=(0,K.s)(V.vx.VoiceCallsMicrophoneStream,e=>{o(4*Math.abs(e.reduce((e,t)=>e+t,0)/e.length))});return()=>e()},[]),(0,i.useEffect)(()=>{t?a(ea.Neutral):e===F.Td.Backend?a(ea.Character):e===F.Td.Client&&a(ea.User)},[e,t]);let x=1e3+(e===F.Td.Backend?l:c)*1024,m=e===F.Td.Initializing?0:30;return(0,r.jsx)(es.E.div,{className:"absolute flex justify-center items-start",transition:{ease:"easeInOut",type:"spring",duration:.25},animate:{background:"radial-gradient(circle ".concat(x,"px at 50% calc(").concat(s,"vh + 75px),  ").concat(el," 0%, ").concat("#1772b444"," ").concat(m,"%, ").concat(d?"#18181b":"#f8f8f8").concat(u?"00":""," 100%)")},style:{zIndex:-1,top:"0",height:"100%",width:"100%",transformOrigin:"center"},children:(0,r.jsx)("svg",{id:"line-circle",width:"256px",height:"256px",viewBox:"0 0 500 ".concat(s,"%"),className:"top-0 absolute overflow-visible origin-center pt-[".concat(ea.Character,"vh]")})})},ei=new Float32Array(18).fill(0);var ec=s(93326),eo=s(61676);let ed=()=>{let{t:e}=(0,B.$G)(),{hangUp:t,toggleMute:s,isUserMuted:a}=Y(),l=e(a?"Calls.unmute":"Calls.mute");return(0,r.jsxs)("div",{className:"flex gap-8 text-sm text-center",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)(ec.zx,{disableRipple:!0,size:"lg",variant:a?"primary":"ghost",onPressStart:()=>{s(),d.iN.elementClicked({referrer:"CallsControls",action:"mute_toggled",value:!a})},className:(0,eo.cn)({"bg-secondary":!a}),isIconOnly:!0,children:[!a&&(0,r.jsx)(x.nPH,{height:"1.5em",color:"var--icon-primary)"}),!!a&&(0,r.jsx)(x.Ibz,{height:"1.5em",color:"var(--icon-inverted)"})]}),(0,r.jsx)("div",{className:"text-sm font-light select-none",children:l})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(ec.zx,{disableRipple:!0,size:"lg",onPressStart:()=>{d.iN.elementClicked({referrer:"CallsControls",action:"call_hangup_pressed"}),t("user hung up"),m.tI.value=!1},isIconOnly:!0,children:(0,r.jsx)(x.LX6,{height:"1.5em",color:"var(--icon-inverted)"})}),(0,r.jsx)("div",{className:"text-sm font-light select-none",children:e("Calls.hang-up")})]})]})},eu=()=>{let{character:e}=(0,y.AU)(),{hasVoice:t,isConnected:s,isCharacterSpeaking:a,isUserMuted:l,isAiThinking:n,voiceCallTurnStatus:c,isConnecting:o,isUserSpeaking:d}=Y(),[u,x]=(0,i.useState)(0),[m,h]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let e=(0,K.s)(V.vx.VoiceCallsMediaStream,e=>{x(Math.abs(e.reduce((e,t)=>e+t,0)/e.length))});return()=>e()},[]),(0,i.useEffect)(()=>{let e=(0,K.s)(V.vx.VoiceCallsMicrophoneStream,e=>{h(Math.abs(e.reduce((e,t)=>e+t,0)/e.length))});return()=>e()},[]),(0,r.jsxs)("div",{className:"absolute top-0 left-0 bg-black flex flex-col gap-1 font-mono text-white text-sm w-96 z-10",children:[(0,r.jsxs)("div",{children:["Character: ",null==e?void 0:e.name]}),(0,r.jsxs)("div",{children:["Is Connexting: ",o?"Yes":"No"]}),(0,r.jsxs)("div",{children:["Connected: ",s?"Yes":"No"]}),(0,r.jsxs)("div",{children:["User muted: ",l?"Yes":"No"]}),(0,r.jsxs)("div",{children:["AI thinking: ",n?"Yes":"No"]}),(0,r.jsxs)("div",{children:["Has voice: ",t?"Yes":"No"]}),(0,r.jsxs)("div",{children:["Character speaking: ",a?"Yes":"No"]}),(0,r.jsxs)("div",{children:["User speaking: ",d?"Yes":"No"]}),(0,r.jsxs)("div",{children:["Turn status: ",c]}),(0,r.jsxs)("div",{children:["Character Speech Amplitude: ",u.toFixed(6)]}),(0,r.jsxs)("div",{children:["Microphone Amplitude: ",m.toFixed(6)]})]})};var ex=s(35716);let em=e=>{let{characterId:t}=e,{t:s}=(0,B.$G)(),a=(0,et.G)()?"#E1EBEF":"#153E57";return(0,r.jsxs)("div",{className:"absolute bottom-8 right-8 hidden md:block",children:[(0,r.jsx)("p",{className:"text-medium/medium mb-3 text-center",style:{color:a},children:s("Chat.chat-on-app")}),(0,r.jsx)("div",{className:"backdrop-blur-sm rounded-xl p-1",style:{borderColor:"".concat(a,"15"),borderWidth:1},children:(0,r.jsx)(ex.QRCode,{value:t?"https://character.ai/chat/".concat(t):"https://character.ai/",size:120,qrStyle:"dots",eyeRadius:2,bgColor:"transparent",fgColor:a,ecLevel:"M",logoImage:"/icon.svg",logoWidth:40,logoHeight:40,removeQrCodeBehindLogo:!0,logoPadding:15,logoPaddingStyle:"circle",logoOpacity:.9,quietZone:10})})]})},eh=()=>{let{t:e}=(0,B.$G)(),{stopCharacterSpeaking:t}=(0,R.c9)(),[s,a]=(0,i.useState)(!1),[l,n]=(0,i.useState)(),[c,o]=(0,i.useState)(!1),{isConnecting:d,hasVoice:u,voiceCallTurnStatus:x,isUserSpeaking:m,isUserMuted:h,isAiThinking:f}=Y();return((0,i.useEffect)(()=>{m&&o(!0)},[m]),(0,i.useEffect)(()=>{let t=!1;u?d?n(e("Calls.status-calling")):x===F.Td.Client?h?n(e("Calls.status-muted")):c?n(e("Calls.status-listening")):n(e("Calls.status-start-speaking")):x===F.Td.Backend?f?n(e("Calls.status-ai-thinking")):(n(e("Calls.status-tap-to-interrupt")),t=!0):n(void 0):n(e("Calls.status-no-voice-selected")),a(t)},[x,d,u,c,h,f,e]),l)?(0,r.jsx)("div",{children:s?(0,r.jsx)(ec.zx,{onPress:()=>{t()},children:(0,r.jsx)("div",{children:l})}):(0,r.jsx)("div",{children:l})}):null};var ef=s(37697);let ep=()=>{let{character:e}=(0,y.AU)(),{isStaff:t}=(0,w.a)(),s=(0,i.useRef)(null),{backgroundImageURL:a,hasCustomBackground:l}=(0,S.OF)(),{config:{enabled:n}}=(0,u.EY)(u.F5.VoiceCallQRCode);return(ee(),e)?(0,r.jsx)(P.a2,{children:(0,r.jsxs)("div",{className:"absolute h-full w-full flex flex-col justify-between items-center p-32 pt-[20vh] z-20 bg-background top-0 left-0",children:[(0,r.jsx)("audio",{ref:s}),!!l&&!!a&&(0,r.jsx)("div",{className:"absolute w-full -z-10 top-0",children:(0,r.jsx)(ef.s,{backgroundImageURL:a})}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)(M.B7,{name:null==e?void 0:e.name,src:null==e?void 0:e.avatar_file_name,size:150}),(0,r.jsxs)("div",{className:"flex flex-col items-center mt-6 gap-2",children:[(0,r.jsx)("h2",{className:"text-xl text-foreground",children:null==e?void 0:e.name}),(0,r.jsx)(I.t,{size:"large"})]})]}),(0,r.jsx)(eh,{}),!!t&&(0,r.jsx)(eu,{}),(0,r.jsx)(ed,{}),(0,r.jsx)(en,{}),n?(0,r.jsx)(em,{characterId:null==e?void 0:e.external_id}):null]})}):null};var ev=()=>((0,O.s)(),(0,r.jsx)(Z,{children:(0,r.jsx)(ep,{})})),eg=s(72422),ej=s(99717),eN=s(69411),eb=s(35206),ew=s(3927),ey=s(70393);function eC(e){let{character:t,referrer:s}=e,{t:a}=(0,B.$G)(),[l,n]=(0,i.useState)(!1),c={type:ey.C2.CHARACTER,character:t};return(0,r.jsxs)(ew.Vq,{open:l,onOpenChange:n,analyticsProps:{referrer:s,type:"ReportCharacterDialog"},children:[(0,r.jsx)(ew.hg,{asChild:!0,children:(0,r.jsx)(ec.zx,{variant:"outline",isIconOnly:!0,"aria-label":a("Common.report"),children:(0,r.jsx)(x.cWE,{className:"size-4 text-muted-foreground"})})}),(0,r.jsx)(eb.o,{isOpen:l,title:a("Moderation.report-character"),report:c,onComplete:()=>n(!1)})]})}var e_=s(16994),ek=s(76843),eS=s(46600),ez=s(91724),eG=s(3048),eM=s(93033),eP=s(31396),eI=s(82876);let eE=e=>{let{activePersonas:t,setOpen:s}=e,{t:a}=(0,B.$G)();return(0,r.jsxs)(ec.zx,{variant:"ghost",className:"w-full flex justify-between gap-2 rounded-spacing-xs",onPress:()=>{s(!0)},children:[(0,r.jsxs)("div",{className:"flex items-center w-fit gap-3",children:[(0,r.jsx)(x.IHp,{className:"text-muted-foreground size-5"}),a("Common.persona")]}),(0,r.jsxs)("div",{className:"flex gap-1 items-center",children:[t.length>0&&(0,r.jsx)("p",{className:"line-clamp-1 text-ellipsis break-anywhere overflow-hidden whitespace-normal text-muted-foreground",children:t[0].participant__name}),(0,r.jsx)("div",{children:(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-3"})})]})]})};function eO(e){let{isLoading:t,open:s,setOpen:a,activePersonas:l,inactivePersonas:n,isError:i,refetch:c,handleNavigatePersona:o,handleSelect:d}=e,{t:u}=(0,B.$G)(),{user:m}=(0,w.a)();return t||!m?null:t||l.length+n.length!==0?(0,r.jsxs)(ew.Vq,{open:s,onOpenChange:a,analyticsProps:{referrer:"Persona",type:"PersonaOverrideDialog"},children:[(0,r.jsx)(eE,{activePersonas:l,setOpen:a}),(0,r.jsxs)(ew.cZ,{hideClose:!0,className:"flex-auto flex flex-col justify-between w-[440px] max-h-[560px] gap-2 pt-0",children:[(0,r.jsxs)("div",{className:"w-full flex justify-between sticky top-0 bg-popover z-10 pt-4",children:[(0,r.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,r.jsxs)(ew.GG,{children:[(0,r.jsx)(eP.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:u("Common.close")})]}),(0,r.jsx)("p",{children:u("Common.persona")})]}),(0,r.jsx)(ec.zx,{variant:"ghost",className:"border-muted-foreground border",onPress:()=>o("new"),children:u("Common.new")})]}),(0,r.jsx)("div",{className:"w-full h-full overflow-y-auto",children:i?(0,r.jsx)(e_.o,{refresh:c}):(0,r.jsxs)(r.Fragment,{children:[l.map(e=>(0,r.jsx)(ek.w,{persona:e,isDefault:!1,selected:!0,handleEditClick:()=>o(e.external_id),handleItemClick:()=>d(e.external_id)},e.external_id)),n.map(e=>(0,r.jsx)(ek.w,{persona:e,isDefault:!1,handleEditClick:()=>o(e.external_id),handleItemClick:()=>d(e.external_id),selected:!1},e.external_id))]})})]})]}):(0,r.jsxs)(ec.zx,{variant:"ghost",className:"flex justify-between w-fit",onPress:()=>o("new"),children:[(0,r.jsx)(x.IHp,{className:"mr-2 size-5"}),u("Common.persona")]})}function eF(e){let{characterId:t}=e,{t:s}=(0,B.$G)(),{user:a}=(0,w.a)(),l=(0,eI.useRouter)(),[n,o]=(0,i.useState)(!1),{personas:u,isLoading:x,isError:m,refetch:h}=(0,eG.T4)(),{settings:f,isLoading:p,isError:v,refetch:g}=(0,eM.Fl)(),{mutate:j}=(0,eM.pC)(),N=m||v,b=(null!=u?u:[]).filter(e=>(0,eS.$u)(e.external_id,t,f)),y=(null!=u?u:[]).filter(e=>!(0,eS.$u)(e.external_id,t,f)),C=(0,i.useCallback)(async()=>{m&&await h(),v&&await g()},[m,h,v,g]),_=e=>{(0,E.K)(s("Error.something-went-wrong"),void 0,"destructive"),(0,c.H)("Failed to enable/disable persona-for-this-character",{error:e})};return(0,r.jsx)(eO,{isLoading:x||p,open:n,setOpen:o,activePersonas:b,inactivePersonas:y,isError:N,refetch:C,handleNavigatePersona:e=>{var t;(null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.username)&&l.push(H.nN.profile(a.user.username,ez.Zo.Personas,{id:e})),o(!1)},handleSelect:e=>{var a;let l={...null!==(a=null==f?void 0:f.personaOverrides)&&void 0!==a?a:{},[t]:(0,eS.$u)(e,t,f)?"":e};j({personaOverrides:l},{onSuccess:e=>{var a;if(!e||"NOT_OK"===e.status){_((null==e?void 0:e.error)||"Failed to update settings");return}d.iN.settingChanged({setting:"persona_updated",referrer:"PersonaOverrideDialog",character_id:t,value:null!==(a=l[t])&&void 0!==a?a:""}),(0,E.K)(s("Common.success")),o(!1)},onError:_})}})}var eT=s(12955),eD=s(46272),eR=s(55541),eB=s(50090),eA=s(68582);let eU=()=>{var e,t;let s=(0,eA.G)(),{t:a}=(0,B.$G)();return s.isGameInProgress||(null===(e=s.highScores)||void 0===e?void 0:e.length)===0?null:(0,r.jsxs)("div",{className:"rounded-spacing-xs overflow-hidden font-sans bg-surface",children:[(0,r.jsx)("div",{className:"text-center p-3 text-md-semibold bg-surface-elevation-2 text-foreground",children:a("Games.your-high-scores")}),(0,r.jsx)("div",{className:"bg-surface",children:null===(t=s.highScores)||void 0===t?void 0:t.toSorted((e,t)=>t.score-e.score).slice(0,5).map((e,t)=>(0,r.jsxs)("div",{className:(0,eo.cn)("flex w-full items-center justify-between px-4 py-1 [&:not(:last-child)]:border-b-1 border-divider",{"border-t":0!==t}),children:[(0,r.jsx)(M.B7,{size:16,name:e.character.participant__name,src:e.character.avatar_file_name}),(0,r.jsx)(eB.Z,{href:H.nN.chat(e.character.external_id),analytics:{name:"elementClicked",properties:{character_id:e.character.external_id,type:"high-score-character-link",value:e.character.participant__name,referrer:"GameHighScores"}},children:(0,r.jsx)("span",{className:"flex-1 font-medium pl-2 text-foreground",children:e.character.participant__name})}),(0,r.jsx)("span",{className:"pr-4 text-foreground",children:e.score})]},t))})]})};var e$=s(52779),eK=s(45444),eV=s(66098),eH=s(97679),eL=s(7702);let eq=()=>{var e;if(null===(e=(0,eA.G)().scoreData.itemResults)||void 0===e?void 0:e.length)return(0,r.jsx)(ec.zx,{isIconOnly:!0,onPress:()=>{eK.o.fire()},className:"absolute top-[calc(50%-20px)] -right-2 z-[1] bg-primary",children:(0,r.jsx)(x.VQN,{})})},eX=e=>{var t;let{swiper:s}=e,a=(0,eA.G)(),l=e=>{a.scoreData.itemResults&&a.scoreData.itemResults[e]===eV.JU.UNSEEN||s.slideTo(e)};return(null==a?void 0:null===(t=a.scoreData)||void 0===t?void 0:t.itemResults)?(0,r.jsx)("div",{className:"hidden md:flex relative gap-2 w-full justify-center items-center",children:a.scoreData.itemResults.map((e,t)=>(0,r.jsx)(ec.zx,{isIconOnly:!0,className:(0,eo.cn)("w-2 h-2 min-w-2 max-w-2 p-0 rounded-full",{"bg-white":e===eV.JU.PLAYING,"bg-[#B869F9]":e===eV.JU.WON,"bg-[#141417]":e===eV.JU.PASSED||e===eV.JU.LOST,"cursor-none pointer-events-none bg-[#E4E4E7]":e===eV.JU.UNSEEN}),onPress:()=>l(t)},t))}):null},eZ=()=>{let{t:e}=(0,B.$G)();return(0,r.jsx)("div",{className:"text-xl text-foreground dark:text-icon-inverted hidden md:flex",children:e("Games.rules")})},eY=()=>{let[e,t]=(0,i.useState)(),s=(0,eA.G)();return(0,i.useEffect)(()=>{e&&s.gameMessages.length>1&&e.slideNext()},[s.gameMessages,e]),(0,r.jsxs)("div",{className:"relative flex flex-col md:gap-2",children:[(0,r.jsx)(eZ,{}),(0,r.jsx)(eL.tq,{allowSlidePrev:!0,className:"w-full",modules:[eH.tl],autoHeight:!0,observer:!0,observeParents:!0,onSwiper:t,spaceBetween:12,children:s.gameMessages.map((e,t)=>{var a;let l=(null===(a=s.scoreData.itemResults)||void 0===a?void 0:a[t])||eV.JU.PLAYING;return(0,r.jsx)(eL.o5,{children:(0,r.jsx)("div",{className:(0,eo.cn)("rounded-[8px] bg-surface-background p-[16px] h-full",{"bg-[#B869F9]":l===eV.JU.WON,"bg-[#141417]":l===eV.JU.LOST}),children:(0,r.jsx)(e$.U,{children:e.markdownText})})},e.markdownText.replace(/\s/g,""))})}),(0,r.jsx)(eq,{}),!!e&&(0,r.jsx)(eX,{swiper:e})]})};s(57095);let eJ=()=>{let{scoreData:{score:e,scoreInfo:t}}=(0,eA.G)(),{t:s}=(0,B.$G)();return(0,r.jsxs)("div",{className:"flex flex-col grow w-full rounded-[8px]",children:[(0,r.jsxs)("div",{className:"flex flex-col pt-[16px] pb-[8px]  items-center justify-center text-center bg-background rounded-tl-[8px] rounded-tr-[8px]",children:[(0,r.jsx)("div",{className:"flex text-display",children:e}),(0,r.jsx)("div",{className:"flex text-md mb-2 text-muted-foreground",children:s("Games.points")})]}),(0,r.jsx)("div",{className:"flex justify-center items-center text-md-semibold text-muted-foreground bg-icon-inverted p-[8px] rounded-bl-[8px] rounded-br-[8px]",children:(0,r.jsx)("div",{className:"text-ellipsis overflow-hidden",children:t})})]})},eW=()=>{let{user:e}=(0,w.a)(),{character:t,scoreData:{score:s,characterScore:a}}=(0,eA.G)(),{t:l}=(0,B.$G)(),n=(null==e?void 0:e.name)||l("Games.you"),i=(null==t?void 0:t.participant__name)||l("Games.Opponent");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col grow w-1/2 rounded-[8px]",children:[(0,r.jsx)("div",{className:"flex justify-center items-center text-md-semibold text-muted-foreground bg-icon-inverted p-[8px] rounded-tl-[8px] rounded-tr-[8px]",children:(0,r.jsx)("div",{className:"whitespace-nowrap  max-w-[100px] text-ellipsis overflow-hidden",children:i})}),(0,r.jsxs)("div",{className:"flex flex-col pt-[16px] pb-[8px]  items-center justify-center text-center bg-surface-elevation-3 rounded-bl-[8px] rounded-br-[8px]",children:[(0,r.jsx)("div",{className:"flex text-display text-foreground",children:a}),(0,r.jsx)("div",{className:"flex text-md mb-2 text-foreground",children:l("Games.points")})]})]}),(0,r.jsxs)("div",{className:"flex flex-col grow w-1/2 rounded-[8px]",children:[(0,r.jsx)("div",{className:"flex justify-center items-center text-md-semibold text-muted-foreground bg-icon-inverted p-[8px] rounded-tl-[8px] rounded-tr-[8px]",children:(0,r.jsx)("div",{className:"whitespace-nowrap max-w-[100px] text-ellipsis overflow-hidden",children:n})}),(0,r.jsxs)("div",{className:"flex flex-col pt-[16px] pb-[8px]  items-center justify-center text-center bg-primary rounded-bl-[8px] rounded-br-[8px]",children:[(0,r.jsx)("div",{className:"flex text-display text-primary-foreground",children:s}),(0,r.jsx)("div",{className:"flex text-md mb-2 text-primary-foreground",children:l("Games.points")})]})]})]})},eQ=()=>{var e;let t=(0,eA.G)(),{scoreData:{scoreInfo:s,scoreCommentary:a,scoreRecipient:l}}=t,{t:n}=(0,B.$G)();return s||a?(0,r.jsxs)("div",{className:"relative flex flex-col grow w-full rounded-[8px]",children:[(0,r.jsx)("div",{className:"absolute top-0 right-2 z-1",children:(0,r.jsx)(eR.l,{side:"left",content:(null===(e=t.selectedGame)||void 0===e?void 0:e.gameRules)||"",className:"tooltip-class",children:(0,r.jsx)(ec.zx,{className:"cursor-help","aria-label":n("Games.rulesTooltip"),variant:"ghost",size:"sm",isIconOnly:!0,children:(0,r.jsx)(x.F3p,{className:"text-muted-foreground"})})})}),(0,r.jsx)("div",{className:"flex justify-start items-center text-md text-foreground bg-icon-inverted p-[8px] px-[16px] rounded-tl-[8px] rounded-tr-[8px]",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{className:"text-md-semibold",children:[s," ",n("Games.points")]})," ",n("Games.to")," ",(0,r.jsx)("span",{className:"text-md-semibold",children:l})]})}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center text-foreground p-[16px] text-md bg-surface-elevation-3 rounded-bl-[8px] rounded-br-[8px]",children:a})]}):null},e0=()=>{let e=(0,eA.G)(),{t}=(0,B.$G)(),s="number"==typeof e.scoreData.characterScore;return e.isGameInProgress||e.isGameInResults?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-xl text-foreground dark:text-icon-inverted",children:t("Games.score")}),(0,r.jsx)("div",{id:"game-score",className:"flex flex-row gap-[12px] w-full",children:s?(0,r.jsx)(eW,{}):(0,r.jsx)(eJ,{})}),!!e.scoreData.scoreCommentary&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-xl text-foreground dark:text-icon-inverted",children:t("Games.judge")}),(0,r.jsx)(eQ,{})]})]}):null};var e1=s(23657);let e2=["#FFD20C","#54AEFF","#FF8648","#FF36C1"],e3=()=>{let[e,t]=(0,i.useState)(!1);return eK.E.useListen(e=>{let{win:s}=e;s&&(t(!0),setTimeout(()=>{t(!1)},1e4))},[t]),(0,r.jsx)("div",{id:"confetti",children:!!e&&(0,r.jsx)(e1.Z,{zIndex:50,colors:e2,duration:5e3,force:.4})})},e5=()=>{var e,t;let s=(0,eA.G)(),{t:a}=(0,B.$G)();return s.isGameInProgress?(0,r.jsxs)(ec.zx,{className:"w-full px-2 py-1 align-items-center bg-primary",onPress:()=>s.endGame(),analytics:{name:"elementClicked",properties:{character_id:null===(e=s.character)||void 0===e?void 0:e.external_id,type:"stop-game",referrer:"StartGameButton"}},children:[(0,r.jsx)(x.wNq,{width:16}),a("Games.stop-game")]}):(0,r.jsx)("div",{className:"flex items-center justify-between gap-2 w-full",children:(0,r.jsxs)(ec.zx,{className:"w-full px-2 py-1 align-items-center bg-primary",onPress:()=>s.startGame(),analytics:{name:"elementClicked",properties:{character_id:null===(t=s.character)||void 0===t?void 0:t.external_id,type:0===s.gameRoundsRemaining?"play":"play-again",referrer:"StartGameButton"}},children:[(0,r.jsx)(x.XjK,{width:24}),a(0===s.gameRoundsRemaining?"Games.play":"Games.play-again")]})})},e6=()=>{var e;let t=(0,eA.G)();return(0,r.jsx)(ec.zx,{isIconOnly:!0,className:"w-full px-2 py-1 align-items-center bg-primary",onPress:()=>{t.endGame(),t.setCurrentGame(null)},analytics:{name:"elementClicked",properties:{character_id:null===(e=t.character)||void 0===e?void 0:e.external_id,type:"stop-game",referrer:"StopGameButton"}},children:(0,r.jsx)(x.wNq,{width:16})})};var e4=s(96577),e8=s.n(e4);let e7=()=>{var e;let t=(0,eA.G)();return t.isGameInProgress?(0,r.jsxs)("div",{className:"hidden md:flex flex-col gap-4 py-8",children:[(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)(eY,{})}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)(e0,{})})]}):t.isGameInResults?(0,r.jsxs)("div",{className:"flex h-full flex-col gap-8 py-8",children:[(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)(e0,{})}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)(eU,{})})]}):(0,r.jsxs)("div",{className:"flex flex-col justify-end grow-1 h-full w-full pt-4",children:[(0,r.jsxs)("div",{className:"mb-10 md:mb-40",children:[(0,r.jsx)(eZ,{}),(0,r.jsx)("div",{className:"rounded-[8px] bg-surface-background p-[16px]",children:null===(e=t.selectedGame)||void 0===e?void 0:e.gameRules})]}),(0,r.jsx)("div",{className:"mb-10 md:mb-40",children:(0,r.jsx)(eU,{})})]})};function e9(){var e;let t=(0,eA.G)(),{t:s}=(0,B.$G)();return(0,r.jsxs)("div",{className:"h-full flex flex-col justify-between md:justify-normal",children:[!t.isGameInProgress&&(0,r.jsx)("div",{children:(0,r.jsx)(ec.zx,{variant:"primary",className:"bg-secondary",isIconOnly:!0,onPress:()=>{t.setCurrentGame(null)},children:(0,r.jsx)(x.xCe,{className:"text-icon-primary",width:16,height:16})})}),!!t.selectedGame&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"relative flex items-center justify-center",children:(0,r.jsx)(e8(),{src:t.selectedGame.gameImage.src,alt:t.selectedGame.title,width:120,height:120,className:(0,eo.cn)("w-[120px] h-[120x] rounded-[20px] shadow-xl")})}),(0,r.jsx)(e3,{}),(0,r.jsxs)("div",{className:"flex flex-col gap-[8px] p-[20px]",children:[(0,r.jsx)("div",{className:"flex items-center justify-center text-xl-medium text-foreground dark:text-icon-inverted",children:(0,r.jsxs)("div",{children:[t.selectedGame.title," ",(0,r.jsx)(eR.l,{side:"left",content:s("Games.beta-tooltip"),children:(0,r.jsx)("span",{className:"text-md text-plus cursor-help",children:(0,r.jsx)("i",{children:s("Games.beta")})})})]})}),(0,r.jsx)("div",{className:"flex items-center justify-center text-center text-md text-foreground dark:text-icon-inverted",children:t.selectedGame.description||s("Games.default-description",{characterName:(null===(e=t.character)||void 0===e?void 0:e.name)||s("Games.your-friend")})})]}),(0,r.jsx)("div",{className:"flex items-center gap-[8px]",children:(0,r.jsx)(e5,{})})]}),(0,r.jsx)(e7,{})]})}let te=()=>{let e=(0,eA.G)(),{t}=(0,B.$G)();return e.isGameInProgress?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center gap-px",children:e.gamePropertiesList.map(e=>(0,r.jsx)("div",{children:(0,r.jsx)(e8(),{src:e.logo.src,alt:e.title,width:60,height:60,className:"rounded-md object-cover"})},e.title))}),(0,r.jsxs)(ec.zx,{className:"w-full px-2 py-1 align-items-center bg-secondary text-foreground min-h-[38px]",onPress:e.toggleSelectGameDialog,analytics:{name:"elementClicked",properties:{type:"play-a-game",referrer:"StartGamesPanel"}},children:[(0,r.jsx)(x.XjK,{width:24}),t("Games.play-a-game")]})]})};var tt=s(55677),ts=s(45736),ta=s(74251),tl=s(8950),tr=s(91503),tn=s(13789);let ti=e=>{let{chatId:t}=e,s=(0,tn.NL)(),{mutate:a}=(0,tr.Bx)();return(0,i.useCallback)((e,l,r)=>{t&&a({chatId:t,modelType:e},{onSuccess:a=>{let r=tr.S_.chat(t);s.setQueryData(r,t=>t?{...t,chat:{...t.chat,preferred_model_type:e}}:t),l()},onError:e=>{var t,s;r((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error_code)===tl.dw.TooManyModelChanges.errorCode,e)}})},[t,a,s])};var tc=s(64253);let to={[tl.Cr.balanced]:{icon:x.dMm,title:"Roar",description:"Chat.ChatModelSelectorModal.model-default-description-v2",default:!0},[tl.Cr.smart]:{icon:x.mCP,title:"Nyan",description:"Chat.ChatModelSelectorModal.model-smart-description-v2",isPlusOnly:!0},[tl.Cr.fast]:{icon:x.W4w,title:"Meow",description:"Chat.ChatModelSelectorModal.model-fast-description-v2"},[tl.Cr.family_friendly]:{icon:x.sC,title:"Goro",description:"Chat.ChatModelSelectorModal.model-family-friendly-description",isBeta:!0},[tl.Cr.memory_optimized]:{icon:x.KyT,title:"Mem",description:"Chat.ChatModelSelectorModal.model-memory-optimized-description",isBeta:!0},[tl.Cr.multilingual]:{icon:x.XaD,title:"Pawly",description:"Chat.ChatModelSelectorModal.model-multilingual-description",isBeta:!0},[tl.Cr.dynamic]:{icon:x.pjr,title:"Dynamic",description:"Chat.ChatModelSelectorModal.model-dynamic-description",isBeta:!0},[tl.Cr.thinking]:{icon:x.pjr,title:"Thinking",description:"Chat.ChatModelSelectorModal.model-thinking-description",isBeta:!0},[tl.Cr.french]:{icon:x.pjr,title:"French",description:"Chat.ChatModelSelectorModal.model-thinking-description",isBeta:!0},[tl.Cr.chinese]:{icon:x.pjr,title:"Chinese",description:"Chat.ChatModelSelectorModal.model-thinking-description",isBeta:!0},[tl.Cr.romantic]:{icon:x.ze2,title:"Soft launch",description:"Chat.ChatModelSelectorModal.model-romantic-description",isBeta:!0,isLimited:!0}};function td(e){var t,s;let{modelType:a,selectedModel:l,initialModel:n,setSelectedModel:i}=e,{t:c}=(0,B.$G)(),o=to[a];if(!o)return null;let{icon:d,title:u,description:m}=o,h=l===a;return(0,r.jsxs)(ec.zx,{variant:"outline",className:(0,eo.cn)("flex items-center gap-3 pl-5 pr-3 h-[60px] min-w-80 my-1 justify-between w-full hover:bg-accent",!h&&"ring-0 ring-transparent",h&&!(null===(t=to[a])||void 0===t?void 0:t.isPlusOnly)&&"ring-2 ring-primary",h&&(null===(s=to[a])||void 0===s?void 0:s.isPlusOnly)&&"ring-2 ring-[#1BA5FB]"),onPress:()=>i(a),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(d,{className:"size-6"}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"font-medium",children:c(u)}),a===n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"\xb7"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:c("Common.current")})]})]}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:c(m)})]})]}),!!o.isPlusOnly&&(0,r.jsx)(tt.s,{size:"md",className:"mr-4"}),!!o.isBeta&&!o.isLimited&&(0,r.jsx)("div",{className:"w-12 h-5",children:(0,r.jsx)(x.HMg,{className:"mr-2"})}),!!o.isLimited&&(0,r.jsx)("div",{className:"w-16 h-4",children:(0,r.jsx)(x.J0w,{className:"mr-2"})})]},a)}function tu(e){var t;let{availableModels:s,chatId:a}=e,{t:l}=(0,B.$G)(),{isPlusUser:n}=(0,w.a)(),{chat:o}=(0,S.RJ)(a),{defaultModel:h}=(0,S.Ni)(),{config:{enabled:f}}=(0,u.EY)(u.F5.AllowChatStyleChangeDuringChat),p=(0,A.BF)(m.Vr),{mutateAsync:v}=(0,eM.pC)(),{settings:g}=(0,eM.Fl)(),j=(0,ta.Dv)(),[N,b]=(0,i.useState)(!1),y=null==o?void 0:o.chat.preferred_model_type,[C,_]=(0,i.useState)(),k=(0,i.useMemo)(()=>{let e=e=>!!e&&Object.values(tl.Cr).includes(e),t=null==o?void 0:o.chat.preferred_model_type;return e(t)?t:e(h)?h:s.find(e=>{var t;return null===(t=to[e])||void 0===t?void 0:t.default})||tl.Cr.balanced},[null==o?void 0:o.chat.preferred_model_type,h,s]),z=(0,i.useMemo)(()=>{var e;return C===k&&"open"===p.status&&"copy-chat"!==p.source&&"new-chat"!==p.source||f&&"open"===p.status&&"model-button"===p.source?l("Chat.ChatModelSelectorModal.continue-chat"):C&&(null===(e=to[C])||void 0===e?void 0:e.isPlusOnly)&&!n?l("Chat.ChatModelSelectorModal.upgrade-and-start-chat"):l("Chat.ChatModelSelectorModal.start-chat")},[C,k,n,l,p,f]);(0,i.useEffect)(()=>{b(C===h)},[C,h]),(0,i.useEffect)(()=>{"open"===p.status&&_(k)},[k,p.status]);let G=(0,i.useCallback)(async e=>{await v({...g,modelPreferenceSettings:{defaultModelType:e}})},[v,g]),M=ti({chatId:a}),P=(0,i.useCallback)(async()=>{let e=()=>{_(void 0),m.Vr.value={status:"closed"}};if("open"!==p.status||!C){e();return}await G(N?C:void 0);let t=C!==y;if(f&&"model-button"===p.source&&t){await M(C,e,(e,t)=>{(0,c.H)("Failed to update chat preferred model type",{error:t}),e?(0,E.K)(l("Chat.too-many-model-changes"),2500,"destructive"):(0,E.K)(l("Common.generic-error"),2500,"destructive"),e&&_(y)}),d.iN.modelSelectorSelection({modalOpenSource:p.source,modelSelected:C,newChatCreated:!1});return}let s=["copy-chat","new-chat"].includes(p.source);(t||s)&&p.onModelSelect(C,N),d.iN.modelSelectorSelection({modalOpenSource:p.source,modelSelected:C}),e()},[p,C,y,N,G,M,f,l]),I=s.filter(e=>{var t;return!(null===(t=to[e])||void 0===t?void 0:t.isBeta)}),O=s.filter(e=>{var t;return null===(t=to[e])||void 0===t?void 0:t.isBeta});return s?(0,r.jsx)(ew.Vq,{open:"open"===p.status,onOpenChange:e=>{e||(m.Vr.value={status:"closed"})},children:(0,r.jsxs)(ew.cZ,{className:(0,eo.cn)("sm:max-w-md p-0 min-h-[420px] flex flex-col",{"w-full h-full":j}),onOpenAutoFocus:e=>e.preventDefault(),children:[(0,r.jsxs)(ew.fK,{className:"px-6 pt-6 pb-2",children:[(0,r.jsx)(ew.$N,{children:l("Chat.ChatModelSelectorModal.title")}),(0,r.jsx)(ew.Be,{children:l("Chat.ChatModelSelectorModal.subtitle")})]}),(0,r.jsx)("div",{className:"max-h-dvh sm:max-h-[60dvh] overflow-y-auto",children:(0,r.jsx)("div",{className:"px-6",children:(0,r.jsxs)("div",{className:"flex flex-col pt-4",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("div",{className:"flex flex-col gap-2",children:I.map(e=>(0,r.jsx)(td,{modelType:e,selectedModel:C,initialModel:k,setSelectedModel:_},e))})}),O.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex flex-col mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(x.ynJ,{height:18,width:18}),(0,r.jsx)("h3",{className:"text-small font-semibold text-muted-foreground",children:l("Chat.ChatModelSelectorModal.beta-models")})]}),(0,r.jsx)("span",{className:"text-small text-muted-foreground",children:l("Chat.ChatModelSelectorModal.beta-models-description")})]}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:O.map(e=>(0,r.jsx)(td,{modelType:e,selectedModel:C,initialModel:k,setSelectedModel:_},e))})]})]})})}),(0,r.jsxs)("div",{className:"px-6 py-4 border-t",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)(ts.X,{id:"useForAllChats",checked:N,onCheckedChange:e=>b(e)}),(0,r.jsx)("label",{htmlFor:"useForAllChats",className:"text-md",children:l("Chat.ChatModelSelectorModal.use-for-all-chats")})]}),(0,r.jsx)(ec.zx,{onPress:async()=>{var e;if(C&&(null===(e=to[C])||void 0===e?void 0:e.isPlusOnly)&&!n){m.Um.value={referrer:"ChatModelSelector",trigger:"change_model"};return}await P()},className:"w-full ".concat(C&&(null===(t=to[C])||void 0===t?void 0:t.isPlusOnly)&&!n?"bg-gradient-to-r from-[#1BA5FB] to-[#004CB0] text-white":""),isDisabled:!C,children:z})]})]})}):null}function tx(e){var t;let{chatId:s,availableModels:a,onStartNewChat:l}=e,{t:n}=(0,B.$G)(),{chat:i}=(0,S.RJ)(s),c=null==i?void 0:i.chat.preferred_model_type;return(null==a?void 0:a.length)?(0,r.jsx)("div",{className:"flex justify-between items-center w-full",children:(0,r.jsxs)(ec.zx,{variant:"ghost",className:"w-full flex justify-between rounded-spacing-xs",onPress:()=>{m.Vr.value={status:"open",source:"model-button",onModelSelect:l}},children:[(0,r.jsxs)("div",{className:"flex items-center w-fit gap-3",children:[(0,r.jsx)(x.T$Z,{className:"size-5 text-muted-foreground"}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:n("Chat.ChatModelSelectorModal.style")})]}),(0,r.jsxs)("div",{className:"flex gap-1 items-center text-muted-foreground",children:[!!c&&!!(null===(t=to[c])||void 0===t?void 0:t.title)&&(0,r.jsx)("div",{children:n(to[c].title)}),(0,r.jsx)("div",{children:(0,r.jsx)(tc.Z,{className:"size-3"})})]})]})}):null}var tm=s(7552),th=s(76330);function tf(){let{t:e}=(0,B.$G)(),[t,s]=(0,i.useState)(!1);return(0,r.jsxs)(tm.yo,{onOpenChange:s,open:t,modal:!1,children:[(0,r.jsx)("div",{className:"flex justify-between items-center w-full",children:(0,r.jsxs)(ec.zx,{variant:"ghost",className:"w-full flex justify-between rounded-spacing-xs",onPress:()=>{m.qM.value=!0},children:[(0,r.jsxs)("div",{className:"flex items-center w-fit gap-3",children:[(0,r.jsx)(th._TT,{className:"size-5 p-1"}),e("Customization.customize")]}),(0,r.jsx)("div",{className:"flex gap-1 items-center",children:(0,r.jsx)("div",{children:(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-3"})})})]})}),(0,r.jsx)(tm.ue,{className:"flex h-dvh flex-col w-96 max-w-80 overflow-auto",children:(0,r.jsx)(tm.sw,{children:(0,r.jsxs)(tm.Tu,{className:"flex flex-row items-center gap-6",children:[(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-4"}),e("Customization.customize")]})})})]})}var tp=s(38978),tv=s(5632),tg=s(36529),tj=s(34581),tN=s(34318),tb=s(81364),tw=s(73910),ty=s(35981),tC=s(83862),t_=s(37940);let tk=i.forwardRef((e,t)=>{let{handleRenameOption:s}=e,{t:a}=(0,B.$G)();return(0,r.jsxs)("div",{onClick:e=>{e.stopPropagation(),s()},ref:t,className:"w-full flex justify-between items-center",children:[a("Common.rename"),(0,r.jsx)(x.dY8,{width:"1rem",height:"1rem"})]})});tk.displayName="RenameOption";let tS=i.forwardRef((e,t)=>{let{handleArchiveOption:s,chatState:a}=e,{t:l}=(0,B.$G)();return(0,r.jsxs)("div",{onClick:e=>{e.stopPropagation(),s()},ref:t,className:"w-full flex justify-between items-center",children:[l(a===tl.sh.archived?"Common.unarchive":"Common.archive"),(0,r.jsx)(x.pNs,{width:"1rem",height:"1rem"})]})});tS.displayName="ArchiveOption";let tz=e=>{let{open:t,setOpen:s,handleRenameOption:a,handleArchiveOption:l,chatState:n}=e,i=(0,tC.YQ)(),c=[];return n!==tl.sh.archived&&c.push({content:(0,r.jsx)(tk,{handleRenameOption:()=>{a(),s(!1)}}),asChild:!1,key:"rename"}),c.push({content:(0,r.jsx)(tS,{handleArchiveOption:()=>{l(),s(!1)},chatState:n}),asChild:!1,key:"archive-or-unarchive"}),(0,r.jsx)(ty.C,{options:c,setIsOpen:s,isOpen:t,asChild:!0,itemClassName:"p-2 px-3 hover:bg-[--transparency-4] text-primary rounded-spacing-xs",children:(0,r.jsx)(ec.zx,{variant:"ghost",className:(0,eo.cn)("min-w-unit-6 w-unit-6 h-unit-6 bg-transparent hover:bg-background opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-all",{"opacity-100":i}),onPress:()=>s(!0),size:"sm",isIconOnly:!0,preventDefault:!0,children:(0,r.jsx)(t_.evw,{})})})},tG=e=>{var t;let{lastDate:s,isRenaming:a,handleFinishRenaming:l,name:n}=e,{t:c}=(0,B.$G)(),[o,d]=(0,i.useState)(null!==(t=null!=n?n:s)&&void 0!==t?t:c("Common.new-chat"));return(0,r.jsx)("div",{className:"w-full",onBlur:e=>{requestAnimationFrame(()=>{var t;(null===(t=e.currentTarget)||void 0===t?void 0:t.contains(document.activeElement))||l(o)})},children:a?(0,r.jsx)(tb.I,{value:o,className:"p-1 px-[6px] rounded-spacing-xs",onClick:e=>e.stopPropagation(),onChange:e=>{e.stopPropagation(),d(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&l(o)},maxLength:tr.ew}):(0,r.jsx)("p",{className:"font-light text-ellipsis line-clamp-2 break-anywhere",children:null!=n?n:s})})};function tM(e){var t,s,a,l,n;let{history:o,characterId:u,isCurrentChat:x,onClickCallback:h,onArchiveCallback:f}=e,p=o.chat_id,[v,g]=(0,i.useState)(!1),j=(0,A.BF)(m.Kw),N=!!j&&o.chat_id===j,{t:b}=(0,B.$G)(),w=(0,tv.useRouter)(),y=(0,tw.Q)(null!==(l=o.last_interaction)&&void 0!==l?l:o.create_time),{mutate:C}=(0,tr.os)(),{mutate:_}=(0,tr.I0)(),{mutate:k}=(0,tr.e7)();(0,i.useEffect)(()=>{m.Kw.value=void 0},[]);let S=null===(t=o.preview_turns)||void 0===t?void 0:t[0],z=(null==S?void 0:null===(s=S.candidates)||void 0===s?void 0:s.length)&&null!==(n=null===(a=S.candidates[0])||void 0===a?void 0:a.raw_content)&&void 0!==n?n:"";return z?(0,r.jsxs)("div",{onClick:()=>{o.state===tl.sh.archived||v||(o.isNeo?(d.iN.characterSelected({referrer:"ChatHistoryItem",characterId:u,chatId:o.chat_id}),w.push(H.nN.chat(u,"hist=".concat(o.chat_id)))):o.chat_id&&u?(m.Ek.value={historyId:o.chat_id,characterId:u},m.nj.value=!0,d.iN.characterSelected({referrer:"ChatHistoryItem",characterId:u,chatId:o.chat_id,action:"legacy_clicked"})):(0,E.K)("Legacy chat currently unavailable",void 0,"destructive"),null==h||h())},className:(0,eo.cn)("group hover:bg-surface-elevation-1 cursor-pointer p-2 rounded-spacing-xs",!!x&&"bg-surface-elevation-1 hover:bg-surface-elevation-2"),children:[!!x&&(0,r.jsx)("p",{className:"text-blue text-md",children:b("Common.current-chat")}),(0,r.jsxs)("div",{className:"items-start justify-start text-left gap-2 flex flex-col max-h-32 overflow-hidden text-ellipsis ",children:[(0,r.jsxs)("div",{className:"w-full flex gap-2 items-start justify-between",children:[(0,r.jsx)(tG,{isRenaming:N,lastDate:y,handleFinishRenaming:e=>{p&&e&&u&&C({chatId:p,name:e,characterId:u},{onSuccess:()=>d.iN.chatUpdated({changes:{name:e},referrer:"ChatHistoryItem",chatId:p}),onError:e=>{(0,c.H)("Failed to rename chat",{error:e}),(0,E.K)(b("Common.generic-error"),2500,"destructive")}}),m.Kw.value=void 0},name:o.name}),!o.isNeo&&(0,r.jsx)("p",{className:"text-center text-sm p-1 rounded-spacing-xs bg-secondary font-light",children:b("Common.legacy")}),(0,r.jsx)(tz,{handleRenameOption:()=>{m.Kw.value=o.chat_id},handleArchiveOption:()=>{if(!p)return;let e=o.state===tl.sh.archived?tl.sh.active:tl.sh.archived,t=()=>{d.iN.chatUpdated({changes:{name:e},referrer:"ChatHistoryItem",chatId:p}),(0,E.K)(e===tl.sh.archived?b("Chat.archived-chat"):b("Chat.unarchived-chat"),2500),e===tl.sh.archived&&f(p)},s=e=>{(0,c.H)("Failed to archive/unarchive chat",{error:e}),(0,E.K)(b("Common.generic-error"),2500,"destructive")};e===tl.sh.archived?_({chatId:p,characterId:u},{onSuccess:t,onError:s}):k({chatId:p,characterId:u},{onSuccess:t,onError:s})},chatState:o.state,open:v,setOpen:g})]}),(0,r.jsx)("p",{className:(0,eo.cn)("text-muted-foreground font-light",{"opacity-50":!o.isNeo}),children:z})]}),(0,r.jsx)(eD.Z,{className:"mt-2"})]}):null}let tP=i.forwardRef((e,t)=>{let{showArchived:s,toggleArchived:a}=e,{t:l}=(0,B.$G)();return(0,r.jsxs)("div",{onClick:a,ref:t,className:"w-full flex justify-between items-center",children:[l(s?"Chat.chat-history":"Chat.archived-history"),s?(0,r.jsx)(x.F_y,{width:"1rem",height:"1rem"}):(0,r.jsx)(x.pNs,{width:"1rem",height:"1rem"})]})});tP.displayName="ShowArchivedOption";let tI=e=>{let{showArchived:t,setShowArchived:s,open:a,setOpen:l}=e,n=[{content:(0,r.jsx)(tP,{showArchived:t,toggleArchived:()=>{s(e=>!e),l(!1)}}),asChild:!1,key:"show-archived"}];return(0,r.jsx)(ty.C,{options:n,setIsOpen:l,isOpen:a,asChild:!0,itemClassName:"p-2 px-3 hover:bg-[--transparency-4] text-primary rounded-spacing-xs",children:(0,r.jsx)(ec.zx,{variant:"outline",className:"min-w-unit-5 w-unit-5 h-unit-5 bg-transparent hover:bg-background opacity-100",onPress:()=>l(!0),size:"sm",isIconOnly:!0,preventDefault:!0,children:(0,r.jsx)(t_.evw,{})})})};function tE(e){let{chatId:t}=e,[s,a]=(0,i.useState)(!1),[l,n]=(0,i.useState)(!1),o=(0,tv.useRouter)(),u=(0,eI.useSearchParams)(),{refresh:m}=(0,L.m)(),{t:h}=(0,B.$G)(),{characterId:f}=(0,y.AU)(),[p,v]=(0,i.useState)(!1),{histories:g,isLoading:j,refetch:N}=(0,tr.Ao)(p?f:null),b=tN.h.useUtils(),{mutate:w}=(0,tp.Kz)(),{deleteInstance:C}=(0,L.m)(),_=(0,i.useCallback)(e=>{var s;if(!t||e!==t||!g)return;let a=null===(s=g.filter(t=>t.state!==tl.sh.archived&&t.chat_id!==e))||void 0===s?void 0:s[0];a?o.replace(H.nN.chat(f,"hist=".concat(a.chat_id))):(C(f),w({externalId:f},{onSuccess:async()=>{await b.discovery.invalidate(),d.iN.characterUpdated({character_id:f,type:"hide_character",referrer:"ChatHistorySheet"}),o.replace("/")},onError:e=>(0,c.H)("Failed to hide character",{error:e})}))},[g,o,t,f,w,C,b.discovery]);(0,i.useEffect)(()=>{p&&(a(!1),N())},[p,N]);let k=!!f&&!!g,S=(0,i.useMemo)(()=>(null!=g?g:[]).filter(e=>s?e.state===tl.sh.archived:e.state!==tl.sh.archived),[g,s]);return(0,r.jsxs)(tm.yo,{onOpenChange:v,open:p,modal:!1,children:[(0,r.jsxs)(ec.zx,{variant:"ghost",className:"w-full flex justify-between rounded-spacing-xs",onPress:()=>{v(!0)},children:[(0,r.jsxs)("div",{className:"flex items-center w-fit gap-3",children:[(0,r.jsx)(x.F_y,{className:"text-secondary-foreground size-5"}),h("Chat.chat-history")]}),(0,r.jsx)("div",{className:"flex gap-1 items-center",children:(0,r.jsx)("div",{children:(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-3"})})})]}),(0,r.jsxs)(tm.ue,{className:"flex h-dvh flex-col w-96 max-w-80",children:[(0,r.jsxs)(tm.Tu,{className:"flex flex-row items-center gap-6",children:[(0,r.jsxs)(tm.sw,{className:"flex flex-row items-center gap-6",children:[(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-4"}),h(s?"Chat.archived-history":"Chat.chat-history")]}),(0,r.jsxs)("span",{className:"right-4 absolute flex flex-row gap-0 items-center",children:[(0,r.jsx)(ec.zx,{isIconOnly:!0,variant:"ghost",onPress:()=>{u&&o.push(H.nN.chat(f)),f&&m(f,!0,!0),d.iN.characterSelected({referrer:"ChatHistory",characterId:f,newHistory:!0,action:"save_and_start_new_chat"}),v(!1)},className:"opacity-50",children:(0,r.jsx)(x.jUn,{height:"1.25em"})}),(0,r.jsx)(tI,{showArchived:s,setShowArchived:a,open:l,setOpen:n})]})]}),(0,r.jsxs)("div",{className:"overflow-y-scroll grow-1 flex flex-col gap-4 -mr-6 pr-2",children:[!!k&&S.map(e=>(0,r.jsx)(tM,{characterId:f,history:e,onClickCallback:()=>v(!1),onArchiveCallback:_,isCurrentChat:!!t&&e.chat_id===t},e.chat_id)),!!k&&0===S.length&&(0,r.jsx)("div",{className:"flex flex-col gap-2 items-center text-center",children:(0,r.jsx)("p",{children:h(s?"Chat.no-archived-chats-yet":"Chat.no-chats-yet")})}),j||!k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tj.O,{className:"w-full h-32"}),(0,r.jsx)(tj.O,{className:"w-full h-32"}),(0,r.jsx)(tj.O,{className:"w-full h-32"}),(0,r.jsx)(tj.O,{className:"w-full h-32"}),(0,r.jsx)(tj.O,{className:"w-full h-32"})]})]})]})]})}var tO=s(20606),tF=s(93808),tT=s(13160);function tD(e){var t,s,a;let{turn:l,characterExternalId:n,handleRefetchPinnedTurns:c}=e,{t:o}=(0,B.$G)(),[u,x]=(0,i.useState)(!1),m=(0,tw.Q)(l.create_time),h=null!==(a=null===(t=l.candidates.filter(e=>e.candidate_id===l.primary_candidate_id))||void 0===t?void 0:t[0])&&void 0!==a?a:null===(s=l.candidates)||void 0===s?void 0:s[0],{publish:f}=(0,L.m)(),p=async()=>{let e=l.turn_key;d.iN.messagePin({value:!1,referrer:"PinnedMemoryItem",...e}),f(n,{type:"set_turn_pin",turnKey:e,isPinned:!1}),await c(),x(!1)};return h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ew.Vq,{open:u,onOpenChange:e=>x(e),analyticsProps:{referrer:"Settings",type:"SettingsDialog"},children:[(0,r.jsxs)(ec.zx,{variant:"ghost",onPress:()=>x(!0),className:"flex flex-col h-fit w-full justify-start hover:bg-surface-elevation-1 cursor-pointer p-2 rounded-spacing-xs",children:[(0,r.jsx)("div",{className:"w-full flex gap-2 items-center",children:(0,r.jsx)("p",{className:"font-light text-lg",children:m})}),(0,r.jsx)("div",{className:(0,eo.cn)("w-full text-left",l.author.is_human?"-mr-6 md:-mr-6":"-ml-6 md:-ml-6"),children:(0,r.jsx)(tT.f,{turn:l,candidate:h})})]}),(0,r.jsxs)(ew.cZ,{children:[(0,r.jsx)("p",{className:"mt-4",children:o("Chat.are-you-sure-you-want-to-unpin")}),(0,r.jsxs)("div",{className:"w-full flex flex-row justify-end gap-2",children:[(0,r.jsx)(ec.zx,{variant:"ghost",onPress:()=>x(!1),children:o("Common.cancel")}),(0,r.jsx)(ec.zx,{onPress:p,children:o("Common.yes")})]})]})]}),(0,r.jsx)(eD.Z,{className:"mt-4"})]}):null}let tR=e=>{var t,s;let{chatId:a}=e,{t:l}=(0,B.$G)(),{character:n}=(0,y.AU)(),{external_id:i,name:c,avatar_file_name:o}=null!=n?n:{},{user:d}=(0,w.a)(),u=null==d?void 0:null===(s=d.user)||void 0===s?void 0:null===(t=s.account)||void 0===t?void 0:t.avatar_file_name,{turns:x,meta:m,isLoading:h,fetchNextPage:f,refetch:p}=(0,tr.gL)(a),v=!!i&&!h&&!(0!==(null!=x?x:[]).length),g=!!(null==m?void 0:m.next_token),j=async()=>{await p()};return i?v?(0,r.jsxs)("div",{className:"flex flex-col gap-2 items-center text-center",children:[(0,r.jsx)("p",{children:l("Chat.no-pinned-memories-yet")}),(0,r.jsx)("p",{className:"text-sm",children:l("Chat.to-pin-a-memory",{name:null!=c?c:l("Chat.the-character")})})]}):(0,r.jsx)(tF.Z,{dataLength:x.length,next:f,hasMore:g,loader:(0,r.jsx)("div",{className:"w-full flex items-center justify-center",children:(0,r.jsx)(tO.E,{})}),className:"flex w-full flex-col items-start gap-1",children:x.map(e=>{var t;return(0,r.jsx)(tD,{turn:{...e,author:{...e.author,avatar_url:null!==(t=e.author.avatar_url)&&void 0!==t?t:e.author.is_human?u:o}},characterExternalId:i,handleRefetchPinnedTurns:j},"pin-".concat(e.turn_key.turn_id))})}):void 0};function tB(e){let{chatId:t}=e,{t:s}=(0,B.$G)(),[a,l]=(0,i.useState)(!1);return(0,r.jsxs)(tm.yo,{onOpenChange:l,open:a,modal:!1,children:[(0,r.jsx)("div",{className:"flex justify-between items-center w-full",children:(0,r.jsxs)(ec.zx,{variant:"ghost",className:"w-full flex justify-between rounded-spacing-xs",onPress:()=>{l(!0)},children:[(0,r.jsxs)("div",{className:"flex items-center w-fit gap-3",children:[(0,r.jsx)(x.shA,{className:"text-secondary-foreground size-5"}),s("Chat.view-pinned-memories")]}),(0,r.jsx)("div",{className:"flex gap-1 items-center",children:(0,r.jsx)("div",{children:(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-3"})})})]})}),(0,r.jsxs)(tm.ue,{className:"flex h-dvh flex-col w-96 max-w-80 overflow-auto",children:[(0,r.jsx)(tm.sw,{children:(0,r.jsxs)(tm.Tu,{className:"flex flex-row items-center gap-6",children:[(0,r.jsx)(x.XCv,{className:"text-muted-foreground size-4"}),s("Chat.chat-pinned-memories")]})}),(0,r.jsx)("div",{className:"flex flex-col gap-4",children:(0,r.jsx)(tR,{chatId:t})})]})]})}function tA(e){let{characterId:t,chatId:s}=e,{selectedGame:a,gamesEnabled:l}=(0,eA.G)(),n=!!a&&l;return(0,r.jsx)("div",{id:"chat-details",className:(0,eo.cn)("relative bg-background z-0 w-80 h-full border-l border-l-divider flex-col p-4 gap-3 overflow-y-scroll",{"hidden 2xl:flex":!n,"border-none hidden md:flex":n}),style:n?{background:"linear-gradient(175deg, #E8DEF2 22.5%, #D4ACFB 100%, #6E4177 100%)"}:{},children:(0,r.jsx)(tU,{characterId:t,chatId:s})})}function tU(e){var t;let{characterId:s,chatId:a,closeMenu:l}=e,{t:n,i18n:i}=(0,B.$G)(),{refresh:c}=(0,L.m)(),o=(0,tv.useRouter)(),u=(0,eI.useSearchParams)(),{user:h}=(0,w.a)(),{character:f}=(0,tp.XS)(null!=s?s:"",i.language),p=(0,S.xg)(),{gamesEnabled:v,selectedGame:g}=(0,eA.G)(),{availableModels:j,defaultModel:b,newChatSurfacesToShowOn:y}=(0,S.Ni)(),{updateDefaultModel:C}=(0,S.Kr)();if(!f)return(0,r.jsx)(tg.f7,{});let _=(e,t)=>{let a=e;!e&&b&&(a=b),u&&o.push(H.nN.chat(s)),s&&(t&&e&&C(e),c(s,!0,!0,a?{preferredModel:a}:void 0),l&&l()),d.iN.characterSelected({referrer:"ChatDetails",characterId:s,newHistory:!0,action:"save_and_start_new_chat"})};return null!==g&&v?(0,r.jsx)(e9,{}):(0,r.jsxs)(r.Fragment,{children:[!!p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-row pt-3 pb-1",children:[(0,r.jsx)(x.ma8,{className:"size-6 text-muted-foreground mr-2"}),(0,r.jsx)("div",{className:"text-md-medium",children:null==p?void 0:p.title})]}),(0,r.jsx)(eD.Z,{className:""})]}),(0,r.jsx)(tg.uB,{characterId:s}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,r.jsx)(ej.o,{characterId:s}),(0,r.jsx)(eN.hv,{characterId:s})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(eC,{character:f}),(0,r.jsx)(eg.m,{thisIsMyCharacter:f.user__username===(null==h?void 0:null===(t=h.user)||void 0===t?void 0:t.username),character:f,alwaysShow:!0,contentClassName:"w-60"})]})]}),!!f.title&&(0,r.jsx)("p",{className:"text-muted-foreground text-sm",children:f.title}),(0,r.jsx)(eD.Z,{className:""}),(0,r.jsxs)("div",{className:"flex flex-col gap-3 h-fit",children:[(0,r.jsx)("div",{className:"flex justify-between w-full pr-2",children:(0,r.jsxs)(ec.zx,{color:"secondary",className:"flex justify-between w-fit gap-4 bg-brand-bg",onPress:()=>{y.has("new-chat-sidebar")?m.Vr.value={status:"open",source:"new-chat",onModelSelect:_}:_()},children:[(0,r.jsx)(x.jUn,{className:"text-muted-foreground size-4"}),n("Chat.start-new-chat")]})}),(0,r.jsx)(eT.R,{}),(0,r.jsx)(tE,{chatId:a}),(0,r.jsx)(tf,{}),!!a&&(0,r.jsx)(tB,{chatId:a}),(0,r.jsx)(eF,{characterId:s}),!!a&&!!j&&(0,r.jsx)(tx,{onStartNewChat:_,chatId:a,availableModels:j})]}),!!v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eD.Z,{}),(0,r.jsx)(te,{})]}),(0,r.jsx)(N.sQ,{characterId:s})]})}let t$=e=>{let{selectedGame:t,onGameSelected:s,className:a}=e,l=(0,eA.G)();return(0,r.jsx)("div",{className:(0,eo.cn)("flex items-start justify-between gap-[20px] mx-auto",a),children:l.gamePropertiesList.map(e=>{var a;let{gameKey:n}=e,i=n===t;return(0,r.jsxs)(ec.zx,{className:(0,eo.cn)("h-full flex flex-col items-center justify-center w-90 rounded-[16px] pt-2 bg-transparent",{"bg-surface-elevation-3":i}),tabIndex:0,onPress:()=>{s(n)},analytics:{name:"elementClicked",properties:{character_id:null===(a=l.character)||void 0===a?void 0:a.external_id,type:"game-selected",value:t,referrer:"GameChoicesDialog"}},children:[(0,r.jsx)(e8(),{src:e.logo.src,alt:n,width:90,height:90,className:(0,eo.cn)("w-[90px] h-[90px] border-2 rounded-[16px] border-transparent")}),(0,r.jsx)("div",{className:(0,eo.cn)("min-h-[40px] flex items-center align-center w-[72px] h-full text-center text-sm-regular text-[12px] leading-[16px] justify-center",{"text-sm-semibold":i}),children:(0,r.jsx)("span",{className:"text-center text-foreground text-wrap",children:e.title})})]},n)})})};function tK(e){var t;let{character:s}=e,{t:a}=(0,B.$G)(),l=(0,eA.G)(),[n,c]=(0,i.useState)(eV.Ox.GUESS_WORD),o=(null==s?void 0:s.participant__name)||a("Games.your-friend");return(0,r.jsx)(ew.Vq,{open:l.selectGameDialogOpen,onOpenChange:l.toggleSelectGameDialog,children:(0,r.jsxs)(ew.cZ,{className:"w-full md:w-[514px] p-[16px] flex flex-col rounded-[16px] bg-transparent shadow-none",hideClose:!0,children:[(0,r.jsx)("div",{className:"flex flex-row justify-end",children:(0,r.jsx)(ew.gC,{className:"w-5"})}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 rounded-[16px] p-[16px] bg-surface-elevation-1 shadow-xl",children:[(0,r.jsx)("div",{className:"text-center text-lg-medium pb-[4px]",children:a("Games.select-a-game",{characterName:o})}),(0,r.jsx)(t$,{selectedGame:n,onGameSelected:e=>{n===e&&c(void 0),c(e)},className:"grid grid-cols-2 md:grid-cols-3 gap-1"}),(0,r.jsxs)(ec.zx,{className:"`w-full px-2 py-1 align-items-center bg-primary",onPress:()=>{n&&(l.setCurrentGame(n),l.toggleSelectGameDialog())},isDisabled:!n,analytics:{name:"elementClicked",properties:{character_id:null===(t=l.character)||void 0===t?void 0:t.external_id,type:"play",referrer:"GameChoicesDialog"}},children:[(0,r.jsx)(x.XjK,{width:24}),a("Games.play")]})]})]})})}function tV(){let{selectedGame:e,gamesEnabled:t,isGameInProgress:s}=(0,eA.G)();return(0,r.jsx)(tm.yo,{open:!!e&&t&&!s,modal:!1,children:(0,r.jsx)(tm.ue,{className:"flex h-dvh flex-col w-96 p-0 border-l-divider visible md:hidden",children:(0,r.jsx)("div",{className:"relative bg-background z-0 w-full h-full flex-col p-4 gap-3 overflow-y-scroll pt-[50px]",style:{background:"linear-gradient(175deg, #E8DEF2 22.5%, #D4ACFB 100%, #6E4177 100%)"},children:(0,r.jsx)(e9,{})})})})}s(80643);let tH=()=>{let{scoreData:e}=(0,eA.G)();return e.scoreCommentary?(0,r.jsx)("div",{className:"p-4 pt-0",children:(0,r.jsx)(eQ,{})}):(0,r.jsx)("div",{className:"p-4 pt-0",children:(0,r.jsx)(eY,{})})},tL=()=>{let{t:e}=(0,B.$G)(),{isGameInProgress:t,selectedGame:s,scoreData:a}=(0,eA.G)();if(s)return(0,r.jsx)(tm.yo,{open:t,modal:!1,children:(0,r.jsx)(tm.ue,{side:"top",className:"flex h-min-[236px] flex-col w-full p-0 border-b-divider visible md:hidden z-[1]",children:(0,r.jsxs)("div",{id:"game-sheet-content",className:"relative w-full h-full",style:{background:"linear-gradient(175deg, #E8DEF2 22.5%, #D4ACFB 100%, #6E4177 100%)"},children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-[23px] pb-2 ml-8",children:[(0,r.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,r.jsx)("div",{className:"ml-4 text-lg-medium items-center flex flex-start self-stretch dark:text-icon-inverted",children:s.title}),(0,r.jsx)(e3,{})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-display dark:text-icon-inverted",children:a.score})," ",(0,r.jsx)("span",{className:"text-tertiary dark:text-icon-inverted",children:e("Games.points")})]}),(0,r.jsx)("div",{children:(0,r.jsx)(e6,{})})]}),(0,r.jsx)(tH,{})]})})})};s(70285);var tq=e=>{let{children:t}=e,{selectedGame:s,gamesEnabled:a}=(0,eA.G)(),[l,n]=(0,A.BF)(m.Gq),c=(0,i.useMemo)(()=>({marginTop:"".concat(l-n,"px")}),[l,n]);return(0,r.jsx)("div",{id:"chat-header-background",className:(0,eo.cn)("fixed left-0 top-0 w-screen h-20 z-[1] backdrop-blur-[20px] border-b-[0.5px] border-solid border-gray-200 dark:border-gray-800 2xl:hidden",{"md:hidden":!!s&&a}),style:c,children:(0,r.jsx)("div",{id:"chat-header",className:"relative w-full md:w-auto justify-between md:ml-14 p-6 pl-16 md:px-12 h-20 flex z-10 transition-all duration-300 ease-in-out ",children:t})})},tX=s(9306),tZ=s(99673),tY=s(96344),tJ=s(28573),tW=s(37529),tQ=s(88370),t0=s(54900);function t1(e){let{referrer:t}=e,{t:s}=(0,B.$G)(),{isPlusUser:a}=(0,w.a)(),l=(0,et.G)();return(0,r.jsx)("div",{className:"flex justify-center items-center ".concat(a?"":"cursor-pointer"," py-2"),style:{background:l?"linear-gradient(85deg, rgba(0, 97, 166, 0.15) 12.75%, rgba(27, 165, 251, 0.15) 95.41%)":"linear-gradient(85deg, rgba(160, 201, 255, 0.15) 12.75%, rgba(27, 165, 251, 0.15) 95.41%)"},onClick:()=>{a||(m.Um.value={referrer:t,trigger:"plus_feature_banner"})},children:(0,r.jsxs)("p",{className:"text-base text-muted-foreground",children:[s("Monetization.premium-feature-prefix")," ",(0,r.jsx)("span",{className:"text-base text-primary",children:s("Common.cai")}),(0,r.jsx)("span",{className:"text-[#1BA5FB]",children:"+"})]})})}let t2=e=>{let{metadata:t,isHumanMessage:s}=e,{userChatColorOverride:a,characterChatColorOverride:l}=(0,S.Kx)(null==t?void 0:t.color_scheme_id);return(0,r.jsxs)("div",{className:(0,eo.cn)("w-[65%] flex",s?"flex-row-reverse":"flex-row"),children:[(0,r.jsx)("div",{className:"w-[5.6px] h-[5.6px] rounded-full",style:{background:"rgba(217, 217, 217, 1)"}}),(0,r.jsx)("div",{className:"w-[67.5px] h-[21.5px] mx-1 ".concat(s?"self-end bg-surface-elevation-3":"self-start bg-surface-elevation-2"),style:{background:s?a:l,borderRadius:"4.5px"}})]})};function t3(e){let{metadata:t}=e,{t:s}=(0,B.$G)();return(0,r.jsx)("div",{className:"w-full max-w-sm mx-auto",children:(0,r.jsxs)("div",{className:"overflow-hidden flex flex-col justify-center items-center h-48",children:[(0,r.jsx)("div",{className:"w-[180px] h-[120px] flex justify-center",children:(0,r.jsx)(t5,{metadata:t})}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground p-3",children:s("Customization.preview")})]})})}let t5=e=>{let{metadata:t}=e;return(0,r.jsxs)("div",{className:"w-full h-full rounded-[13.5px] relative border border-foreground-300 bg-surface overflow-hidden",children:[!!(null==t?void 0:t.background_image_url)&&(0,r.jsx)(ef.s,{small:!0,backgroundImageURL:null==t?void 0:t.background_image_url}),(0,r.jsxs)("div",{className:"relative flex flex-col justify-center items-center w-full h-full gap-3",children:[(0,r.jsx)(t2,{metadata:t,isHumanMessage:!1}),(0,r.jsx)(t2,{metadata:t,isHumanMessage:!0})]})]})};var t6=s(28830),t4=s(92014);let t8=e=>{var t,s;return(null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)==="prompt does not meet our content guidelines"},t7=[[0],[5,6,7,8,-5,-6,-7,-8],[-2,-4,-3,-1,3,2,1,4],[0,1,-1,2,-2]],t9=[[-3,-4,-5],[-2,-1,0],[0,-1,1],[5,3,4]],se={lightTheme:{userBubbleColor:"rgba(217, 217, 223, 0.9)",characterBubbleColor:"rgba(228, 228, 231, 0.85)"},darkTheme:{userBubbleColor:"rgba(48, 49, 54, 0.9)",characterBubbleColor:"rgb(38, 39, 43, 0.85)"}};var st=s(71245),ss=s(70677),sa=s(58518),sl=s(6364);function sr(e){let{onBack:t,onBackgroundSelect:s,onCardSelect:a,onContextIdCreate:l}=e,{width:n}=(0,sa.Z)(),o=(0,ta.Dv)(),{t:d}=(0,B.$G)(),[u,m]=(0,i.useState)(null),[h,f]=(0,i.useState)([]),[p,v]=(0,i.useState)(""),[g,j]=(0,i.useState)(!1),{mutate:N}=(0,st.I)(),b=(0,i.useRef)(null),w=(0,i.useRef)(!1),y=(o?n:352)/4,C=16/9*y,_=(0,i.useMemo)(()=>h.map((e,t)=>{let s=t7[t%t7.length],a=s[Math.floor(Math.random()*s.length)],l=t9[t%t9.length],r=l[Math.floor(Math.random()*l.length)];return{top:"".concat(a,"px"),transform:"rotate(".concat(r,"deg)")}}),[h]),k=(0,i.useCallback)(()=>{if(!p.trim())return;j(!0),m(null);let e=(0,sl.Z)();a(void 0),N({prompt:p,imageSize:ss.jh.Portrait9x16,numImages:4,context_id:e},{onSuccess:t=>{f(t),j(!1),l(e)},onError:e=>{j(!1),t8(e)?((0,c.H)("Failed to generate background image due to prompt",{error:e,extra:{prompt:p}}),(0,E.K)(d("Customization.image-prompt-error-title"),void 0,"destructive",d("Customization.image-prompt-error-description"))):((0,c.H)("Failed to generate background image",{error:e}),(0,E.A)(d("Error.something-went-wrong")))}})},[N,p,d,l,a]),S=e=>{m(e),a(e)};return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,r.jsxs)("div",{className:"flex justify-between w-full pr-3",children:[(0,r.jsx)(ec.zx,{variant:"ghost",onPress:t,children:(0,r.jsx)(x.xCe,{className:"size-6 text-icon-primary"})}),!!u&&(0,r.jsx)(ec.zx,{variant:"primary",onPress:()=>{u&&(s(u),t())},children:d("Common.select")})]}),0===h.length&&!g&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 min-h-96",children:[(0,r.jsx)(x.tWY,{className:"size-20 p-4 text-muted-foreground"}),(0,r.jsx)("p",{className:"text-center text-muted-foreground text-md",children:d("Customization.generate-description")})]}),!!g&&(0,r.jsx)(t6.Z,{className:"min-h-96"}),h.length>0&&!g&&(0,r.jsx)("div",{className:"relative flex items-end justify-center w-full min-h-96 px-2",children:h.map((e,t)=>{let{top:s,transform:a}=_[t];return(0,r.jsx)("div",{onClick:()=>S(e),className:(0,eo.cn)("rounded-xl shadow-lg cursor-pointer transition-transform duration-300 ease-in-out border-spacing-2 bg-cover bg-center bg-primary",u===e?"ring-4 ring-primary z-10":"ring-2 ring-foreground z-0 opacity-80","hover:scale-105","transform ".concat(0!==t?"-ml-1":"")),style:{backgroundImage:e?"url(".concat(e,")"):"none",width:"".concat(y,"px"),height:"".concat(C,"px"),top:s,transform:a}},t)})}),(0,r.jsx)("div",{className:"relative w-full mt-6 p-3",children:(0,r.jsx)("div",{className:"relative w-full flex items-center gap-2",children:(0,r.jsxs)("div",{className:"relative w-full",children:[(0,r.jsx)(t4.g,{autoFocus:!o,ref:b,rows:1,className:"bg-background placeholder:text-placeholder border-1 border-border-outline h-12 py-3 px-4 rounded-3xl",inputMode:"text",placeholder:d("Customization.generate-placeholder"),onChange:e=>v(e.target.value),value:p,onCompositionStart:()=>{w.current=!0},onCompositionEnd:()=>{w.current=!1},onKeyDown:e=>{"Enter"!==e.key||w.current||e.shiftKey||(e.preventDefault(),k())}}),(0,r.jsx)("div",{onClick:()=>{var e;k(),null===(e=b.current)||void 0===e||e.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer",children:(0,r.jsx)(x.qzz,{className:p?"text-primary":"text-placeholder",height:24})})]})})})]})}var sn=s(96474);function si(e){let{selectedColorSchemeId:t,onColorSelect:s}=e,{t:a}=(0,B.$G)(),l=(0,et.G)(),n=(0,ta.Dv)(),[c,o]=(0,i.useState)(-1),d=(0,i.useMemo)(()=>{let e=Object.values(sn.I).filter(e=>!0!==e.excludeFromPicker);return e.unshift(se),e},[]);return(0,r.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,r.jsxs)("div",{className:"w-full flex justify-between items-center pb-2 max-w-sm mx-auto",children:[(0,r.jsx)("h4",{className:"flex items-center",children:a("Customization.chat-color")}),(0,r.jsx)("span",{className:"text-sm flex items-center",children:a(t?"Customization.ColorSchemes.".concat(t):"Common.default")})]}),(0,r.jsx)("div",{className:"w-full max-w-sm px-4 py-2 rounded-sm border-1 border-foreground-200 flex justify-center",children:(0,r.jsx)("div",{className:"grid ".concat(n?"grid-cols-5":"grid-cols-6"," gap-5"),children:Object.values(d).map((e,t)=>(0,r.jsx)("div",{onClick:()=>{o(t),s(e.id)},className:"relative w-10 h-10 rounded-full cursor-pointer flex items-center justify-center ".concat(c===t?"ring-1 ring-offset-1 ring-current":""),children:(0,r.jsx)("div",{className:"w-9 h-9 rounded-full overflow-hidden",style:{backgroundImage:"linear-gradient(135deg, ".concat(l?e.darkTheme.characterBubbleColor:e.lightTheme.characterBubbleColor," 50%, ").concat(l?e.darkTheme.userBubbleColor:e.lightTheme.userBubbleColor," 50%)")}})},t))})})]})}let sc=e=>{let{chatId:t,character:s}=e,{t:a}=(0,B.$G)(),l=(0,A.BF)(m.qM),{isPlusUser:n}=(0,w.a)(),o=(0,ta.Dv)(),u=(0,ta.Fv)(),[h,f]=(0,i.useState)(!1),[p,v]=(0,i.useState)(void 0),[g,j]=(0,i.useState)(void 0),[N,b]=(0,i.useState)(void 0),{chat:y}=(0,S.RJ)(t),C=null==y?void 0:y.metadata,{mutate:_}=(0,tr.Mk)();(0,i.useEffect)(()=>{l&&d.iN.modalOpened({referrer:"Chat",type:"CustomizeChat"})},[l]),(0,i.useEffect)(()=>{t&&C&&j({...C,chat_id:t})},[t,C]);let k=(e,t)=>(null==e?void 0:e.background_image_url)!==(null==t?void 0:t.background_image_url),z=(e,t)=>(null==e?void 0:e.color_scheme_id)!==(null==t?void 0:t.color_scheme_id),G=(0,i.useMemo)(()=>z(g,C)||k(g,C),[g,C]),M=(0,i.useCallback)(e=>{if(!n){m.Um.value={referrer:"CustomizeChat",trigger:"set_color"};return}j(t=>t?(null==C?void 0:C.color_scheme_id)==="default"?{...t,color_scheme_id:void 0}:{...t,color_scheme_id:e===(null==C?void 0:C.color_scheme_id)?null==C?void 0:C.color_scheme_id:e}:t)},[n,C]),P=(0,i.useCallback)(e=>{j(t=>t?{...t,background_image_url:e}:t)},[]),I=(0,i.useCallback)(e=>{v(e)},[]),O=(0,i.useCallback)(()=>{j(e=>e?{...e,background_image_url:void 0}:e)},[]),F=(0,i.useCallback)(()=>{if(!n){m.Um.value={referrer:"CustomizeChat",trigger:"set_wallpaper"};return}v(void 0),f(!0)},[n]),T=(0,i.useCallback)(()=>{t&&G&&g&&_(g,{onSuccess:()=>{m.qM.value=!1,k(g,C)&&d.iN.settingChanged({setting:"chat_background",type:"changed",value:g.background_image_url,old_value:null==C?void 0:C.background_image_url,referrer:"CustomizeChatDialog",context_id:N}),z(g,C)&&d.iN.settingChanged({setting:"chat_color_scheme",type:"changed",value:g.color_scheme_id,old_value:null==C?void 0:C.color_scheme_id,referrer:"CustomizeChatDialog",context_id:N})},onError:e=>{(0,c.H)("Failed to update chat metadata",{error:e,extra:{chatId:t,newMetadata:g}}),(0,E.K)(a("Customization.save-failed"),void 0,"destructive")}})},[G,C,g,_,t,a,N]),D=(0,i.useCallback)(e=>{(e||!G||window.confirm(a("Common.unsaved-changes-warning")))&&(e||j(C),m.qM.value=!1)},[G,C,a]);return((0,i.useEffect)(()=>{!l&&G&&j(C)},[l,G,C]),g&&s)?(0,r.jsx)(ew.Vq,{open:l,onOpenChange:D,children:(0,r.jsx)(ew.cZ,{hideClose:!0,className:(0,eo.cn)("pt-[14px] max-w-lg overflow-y-auto flex flex-col gap-4 md:min-w-lg bg-surface-elevation-1 text-foreground border-spacing-3",o?"h-dvh px-1.5 w-screen":"w-full","w-[400px] px-2",h&&p?"bg-cover bg-center bg-no-repeat":""),style:{backgroundImage:h&&p?"url(".concat(p,")"):"none"},children:h?(0,r.jsx)(sr,{onBack:()=>f(!1),onBackgroundSelect:P,onCardSelect:I,onContextIdCreate:b}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ew.fK,{className:"min-h-14 h-fit w-full flex flex-row justify-between items-center px-5 pt-1 -mb-4",children:[(0,r.jsxs)("div",{className:"flex flex-row gap-4 text-md items-center",children:[(0,r.jsxs)(ew.GG,{children:[(0,r.jsx)(x.Two,{height:"1.25em",color:"var(--icon-secondary)"}),(0,r.jsx)("span",{className:"sr-only",children:a("Common.close")})]}),(0,r.jsx)(ew.$N,{children:a("Customization.customize")})]}),(0,r.jsx)("div",{className:"pr-4",children:!!G&&(0,r.jsx)(ec.zx,{variant:"primary",onPress:T,className:"mb-2",children:a("Common.save")})})]}),(0,r.jsx)(t1,{referrer:"CustomizeChat"}),(0,r.jsx)(t3,{metadata:g}),(0,r.jsx)("div",{className:"w-full flex flex-col items-center px-3",children:(0,r.jsxs)("div",{className:"w-full px-4 py-2 rounded-sm flex justify-between items-center border-1 border-foreground-200",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"m-0 font-md-semibold text-foreground",children:a("Customization.wallpaper")}),(0,r.jsx)("p",{className:"m-0 text-muted-foreground text-md",children:a("Customization.wallpaper-subtitle")})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 ml-2",children:[(0,r.jsx)(ec.zx,{className:"border-1 border-foreground-200 mb-2 min-w-[100px]",variant:g.background_image_url?"outline":"primary",onPress:F,children:g.background_image_url?a("Common.change"):a("Common.add")}),!!g.background_image_url&&(0,r.jsx)("span",{onClick:O,className:"cursor-pointer text-destructive text-sm-semibold",children:a("Form.remove")})]})]})}),(0,r.jsx)("div",{className:(0,eo.cn)("w-full px-3 rounded-sm shadow-sm",!u&&"py-2"),children:(0,r.jsx)(si,{selectedColorSchemeId:g.color_scheme_id||"",onColorSelect:M})})]})})}):null};s(97449);var so=s(41591),sd=s(31727);function su(e){let{characterId:t,chatId:s}=e,[a,l]=(0,i.useState)(!1),{t:n}=(0,B.$G)(),c=(0,eA.G)(),o=(0,i.useCallback)(()=>{c.gamesEnabled&&c.toggleSelectGameDialog()},[c]);return(0,r.jsxs)("div",{className:"flex gap-2",children:[!!c.gamesEnabled&&(0,r.jsx)(eR.l,{content:n("Games.play-a-game"),side:"top",children:(0,r.jsx)(ec.zx,{analytics:{name:"elementClicked",properties:{referrer:"ChatGamesButton",action:"play_game"}},variant:"outline",isIconOnly:!0,onPress:o,children:(0,r.jsx)(x.XjK,{className:"size-7 text-muted-foreground"})})}),(0,r.jsx)(eT.R,{isCompact:!0}),(0,r.jsx)("div",{className:"2xl:hidden",children:(0,r.jsxs)(tm.yo,{open:a,onOpenChange:l,modal:!1,children:[(0,r.jsx)(ec.zx,{"aria-label":n("Common.view-character-details"),variant:"outline",isIconOnly:!0,onPress:()=>{l(!0)},children:(0,r.jsx)(t_.evw,{})}),(0,r.jsx)(tm.ue,{className:"flex h-dvh flex-col w-96 overflow-y-scroll",children:(0,r.jsx)(tU,{characterId:t,chatId:s,closeMenu:()=>l(!1)})})]})})]})}var sx=s(84691);function sm(e){var t;let{user:s,token:a}=(0,w.a)(),{characterId:l,characterPagePath:n}=e,o=(0,A.BF)(m.AR);return(0,r.jsx)(L.R,{getAxiosInstance:G.H,originId:"web-next",userId:null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.id,useCentrifuge:!1,errorLogger:c.H,children:(0,r.jsx)(C.w,{children:(0,r.jsx)(y.Au,{children:(0,i.createElement)(sh,{...e,token:a,key:l,characterPagePath:n})})})},"".concat(l,"-debug:").concat(o))}function sh(e){var t;let{characterId:s,newHistoryOptions:a,historyOverride:l,token:n,characterPagePath:c}=e,{t:d,i18n:u}=(0,B.$G)(),{character:x,data:h,error:f}=(0,tp.XS)(null!=s?s:"",u.language),p=(0,A.BF)(m.tI);(0,z.N)();let v=(null==h?void 0:h.data.status)==="NOT_OK",{processedTurns:g,chatId:w,primaryCandidateId:y,primaryCandidateMap:C,streamingStatus:G,introMessage:M,chatReady:P,showLoading:I}=(0,S.qw)(s,a,l);(0,S.bh)(),(0,o.Xu)("Chat",{character_id:s,chat_id:w},{disabled:!w}),(0,so.JE)(g,s),(0,i.useEffect)(()=>{w&&(m.jN.value=w)},[w]),(0,S.io)(),(0,S.eI)();let{isChatDisabled:E}=(0,S.Z7)(),{chat:O}=(0,S.RJ)(w||void 0),F=null==O?void 0:null===(t=O.metadata)||void 0===t?void 0:t.background_image_url,{availableModels:T}=(0,S.Ni)();if(v)return(0,r.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center gap-4",children:[(0,r.jsx)(b.Z,{}),d("Chat.sorry-this-character-is-not-available-to-chat")]});let D=!!F;return(0,r.jsx)(_.ie,{authToken:n,characterId:s,chatId:w,candidateId:y,onRequestVoice:()=>{m.UK.value=!0},children:(0,r.jsxs)(eA.U,{chatMessages:g,streamingStatus:G,character:x,children:[(0,r.jsx)(tK,{character:x}),(0,r.jsxs)(k.X4,{children:[!!x&&(0,r.jsx)(tQ.e,{name:x.participant__name,title:x.title,characterId:s,character_page_path:c,author:x.user__username}),(0,r.jsx)(t0.B,{}),(0,r.jsxs)("div",{className:"flex h-dvh",children:[(0,r.jsxs)("div",{className:"relative flex flex-col w-full items-center flex-1 h-dvh",children:[!!D&&(0,r.jsx)(ef.s,{backgroundImageURL:F}),(0,r.jsxs)(tq,{children:[!!s&&(0,r.jsx)(tg.Gn,{characterId:s,characterPagePath:c}),(0,r.jsx)(su,{characterId:s,chatId:null!=w?w:void 0}),(0,r.jsx)(tL,{})]}),(0,r.jsx)(j,{}),(0,r.jsx)(N.mI,{}),(0,r.jsx)("div",{className:"relative flex flex-col items-center h-full w-full overflow-x-hidden",children:(0,r.jsxs)("div",{id:"chat-body",className:"flex flex-col items-center absolute w-full h-full top-0 left-0",children:[(0,r.jsx)(tV,{}),P?(0,r.jsxs)(r.Fragment,{children:[!I&&!!g&&(0,r.jsx)("div",{className:"relative flex w-full flex-col justify-start h-full overflow-y-scroll overflow-x-hidden align-middle",children:(0,r.jsx)(sx.j,{characterId:s,chatTurns:g,primaryCandidateMap:C,hasCustomBackground:D},s)}),!!I&&!!M&&(0,r.jsxs)("div",{className:"top-20 flex size-full flex-col justify-s max-w-3xl tart w-full align-middle relative",children:[(0,r.jsx)(tZ.x,{turn:M,isLastTurn:!1,containerClassName:"mx-auto my-0",characterId:s}),(0,r.jsx)(tX.U,{})]}),(0,r.jsx)("div",{className:"flex flex-col max-w-2xl items-center w-full",children:E?(0,r.jsx)(sd.VU,{}):(0,r.jsx)(sd.JB,{streamingStatus:G,chatId:w})})]}):(0,r.jsx)(sf,{charError:f})]})})]}),(0,r.jsx)(tA,{characterId:s,chatId:w||void 0}),(0,r.jsx)(tY.i,{}),(0,r.jsx)(tJ.K,{})]}),!!p&&(0,r.jsx)(ev,{}),!!w&&!!x&&(0,r.jsx)(sc,{chatId:w,character:x}),!!w&&!!T&&(0,r.jsx)(tu,{availableModels:T,chatId:w})]})]})})}let sf=e=>{let{charError:t}=e,{t:s}=(0,B.$G)();return(0,r.jsxs)("div",{className:"top-20 flex size-full flex-col justify-s max-w-3xl tart w-full align-middle relative",children:[!!t&&(0,r.jsxs)("div",{className:"mt-12 flex justify-center items-center flex-col gap-3",children:[(0,r.jsx)(b.Z,{}),s("Chat.something-went-wrong-loading-the-chat"),(0,r.jsx)("div",{className:"text-mono text-sm text-muted-foreground",children:t instanceof Error&&t.message})]}),!t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tW.N,{}),(0,r.jsx)(tX.U,{})]}),(0,r.jsx)("div",{className:"flex w-full  flex-col max-w-2xl absolute bottom-12",children:(0,r.jsx)(sd.QT,{})})]})};var sp=s(213),sv=!0;let sg="experimental-edge",sj=e=>{let{isSignedOut:t,characterId:s,historyOverride:a,characterPagePath:l,newHistoryOptions:n}=e,c=(0,tv.useRouter)();return((0,i.useEffect)(()=>{let{scene:e,...t}=c.query;if(e){let e={pathname:c.pathname,query:t};c.replace(e,void 0,{shallow:!0})}}),t)?(0,r.jsx)(sp.Y,{characterId:s,characterPagePath:l}):(0,r.jsx)(sm,{characterId:s,historyOverride:a,characterPagePath:l,newHistoryOptions:n})};sj.getLayout=function(e){return(0,r.jsx)(n.d,{children:e})},sj.SignedOut=sj;var sN=sj},37697:function(e,t,s){"use strict";s.d(t,{s:function(){return n}});var a=s(52322),l=s(61676),r=s(2784);s(3300);let n=e=>{let{backgroundImageURL:t,small:s}=e,n=(0,r.useRef)(null),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{n.current&&i.current&&(n.current.style.setProperty("--cai-plus-custom-background","url(".concat(t,")")),i.current.style.setProperty("--cai-plus-custom-background","url(".concat(t,")")))},[t]),(0,a.jsxs)("div",{id:"chat-background",className:(0,l.cn)("absolute left-0 w-full h-dvh flex justify-center items-center overflow-hidden pointer-events-none",s?"h-full small":"h-dvh"),children:[(0,a.jsx)("div",{ref:i,id:"background-blur-layer",className:"custom-background absolute w-full h-full bg-cover bg-center blur-3xl origin-center scale-[1.2]"}),(0,a.jsx)("div",{className:"background-layer tint-layer absolute w-full h-full"}),(0,a.jsx)("div",{ref:n,id:"foreground-image-layer",className:(0,l.cn)("foreground-image absolute w-full h-full aspect-[9/16]",s?"max-w-[65%]":"max-w-screen-md")}),(0,a.jsx)("div",{className:"foreground-layer tint-layer absolute w-full h-full"})]})}},97449:function(){},3300:function(){},80643:function(){},57095:function(){},70285:function(){}},function(e){e.O(0,[9655,6739,3423,8945,10,3371,7702,2691,7679,2740,3901,2544,2106,6302,7378,8361,3811,8155,6522,2888,9774,179],function(){return e(e.s=79151)}),_N_E=e.O()}]);